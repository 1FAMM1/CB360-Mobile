<!DOCTYPE html>
<html lang="pt-PT">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WSMS Auto Creator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #F8F9FA;
      overflow-x: auto;
      cursor: default;
      user-select: none;
    }

    /* ---- HEADER ---- */
    .header {
      width: 100%;
      height: 70px;
      background-color: #DC3545;
      display: flex;
      align-items: center;
      padding: 0 20px;
      position: relative;
    }

    .header-logo {
      height: 60px;
      margin-top: 4px;
      margin-left: 0px;
    }

    .header-title-container {
      flex-grow: 1;
    }

    .header-title {
      color: white;
      font-size: 16px;
      font-weight: bold;
      margin: 0 15px;
    }

    .header-subtitle,
    .header-authorization {
      color: #FFE6E6;
      font-size: 12px;
      margin: 0 15px;
    }

    .header-authorization {
      font-style: italic;
      font-size: 10px;
    }

    .header-badge-360 {
      background-color: #B02A37;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 14px;
    }

    /* ---- SIDEBAR PRINCIPAL ---- */
    .sidebar {
      position: absolute;
      left: 0;
      top: 70px;
      width: 220px;
      height: calc(100vh - 110px);
      background-color: #343A40;
      padding: 20px 10px;
    }

    .sidebar-menu-button {
      width: 200px;
      height: 45px;
      background-color: #343A40;
      color: white;
      border: none;
      text-align: left;
      padding: 0 15px;
      margin-bottom: 5px;
      cursor: pointer;
      font-size: 9pt;
      transition: background-color 0.2s;
    }

    .sidebar-menu-button:hover {
      background-color: #495057;
    }

    .sidebar-menu-button.active {
      background-color: #DC3545;
    }

    /* ---- PÁGINAS ---- */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .container {
      width: 100vw;
      height: 100vh;
      background-color: #F8F9FA;
      position: relative;
      margin: 0;
      box-shadow: none;
    }

    .main-content {
      position: absolute;
      left: 220px;
      top: 70px;
      width: calc(100vw - 220px);
      height: calc(100vh - 70px);
      padding: 30px;
      overflow-y: auto;
    }

    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #212529;
      margin-bottom: 20px;
    }

    .card {
      background: rgba(235, 235, 235, 0.85);
      border-radius: 16px;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.12);
      border: 1px solid rgba(200, 200, 200, 0.55);
      margin-bottom: 10px;
      position: relative;
      padding: 10px;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
    }

    .card.last-card {
      margin-bottom: 50px;
    }

    .card-header {
      background: rgba(220, 53, 69, 0.85);
      backdrop-filter: blur(12px) saturate(180%);
      -webkit-backdrop-filter: blur(12px) saturate(180%);
      padding: 9px 20px;
      font-weight: 600;
      color: #fff;
      font-size: 13px;
      border-radius: 12px 12px 0 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      border-bottom: 3px solid rgba(255, 255, 255, 0.25);
      text-shadow: 0 3px 2px rgba(0, 0, 0, 0.25);
    }

    .card-header:hover {
      background: rgba(220, 53, 69, 0.95);
      transition: background 0.3s ease;
    }

    .card-body {
      padding: 20px;
      color: #495057;
      font-size: 14px;
      line-height: 1.6;
    }

    .card-body p {
      margin-bottom: 10px;
    }

    .card-body>* {
      transition: all 0.3s ease;
    }

    #availability-card {
      display: none;
    }

    .form-row {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 11px;
      font-weight: bold;
      color: #6C757D;
    }

    .form-group input,
    .form-group select {
      height: 25px;
      border: 1px solid #CED4DA;
      padding: 0 8px;
      font-size: 10px;
      background: white;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #80BDFF;
      box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.25);
    }

    .grid-2fr {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .grid-3fr {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0px;
    }

    .vehicle-card,
    .victims-card,
    .extras-card,
    .demage-card,
    .burned-card,
    .observ-card {
      background: rgba(248, 249, 250, 0.9);
      backdrop-filter: blur(8px) saturate(150%);
      -webkit-backdrop-filter: blur(8px) saturate(150%);
      border-radius: 5px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 12px;
      min-height: 100px;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    .vehicle-card:hover,
    .victims-card:hover,
    .extras-card:hover,
    .demage-card:hover,
    .burned-card:hover,
    .observ-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.12);
    }

    .field-card-title {
      font-size: 12px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 10px;
    }

    .vehicle-fields {
      display: flex;
      gap: 5px;
    }

    .vehicle-field {
      display: flex;
      flex-direction: column;
    }

    .vehicle-field-horizontal,
    .global-field-horizontal {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 3px;
    }

    .vehicle-field label,
    .vehicle-field-horizontal label,
    .global-field-horizontal label {
      font-size: 11px;
      color: #6C757D;
      width: auto;
    }

    .vehicle-field input,
    .vehicle-field select,
    .vehicle-field-horizontal input,
    .vehicle-field-horizontal select,
    .global-field-horizontal input,
    .global-field-horizontal select {
      height: 25px;
      border: 1px solid #CED4DA;
      padding: 0 8px;
      font-size: 10px;
      background: white;
    }

    .vehicle-field input:focus,
    .vehicle-field select:focus,
    .vehicle-field-horizontal input:focus,
    .vehicle-field-horizontal select:focus,
    .global-field-horizontal input:focus,
    .global-field-horizontal select:focus {
      outline: none;
      border-color: #80BDFF;
      box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.25);
    }

    .warning-text {
      color: #DC3545;
      font-weight: bold;
      font-size: 10px;
      max-width: 700px;
      padding: 0 20px;
    }

    .status-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: #F8F9FA;
      border-top: 3px solid #DC3545;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .system-info {
      position: absolute;
      bottom: 5px;
      left: 20px;
      font-size: 12px;
      color: #6C757D;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: -25px;
      margin-right: 20px;
      margin-bottom: 15px;
    }

    .action-buttons button {
      min-width: 100px;
    }

    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      font-size: 10px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .btn-success {
      background-color: #28A745;
      color: white;
    }

    .btn-success:hover {
      background-color: #218838;
    }

    .btn-danger {
      background-color: #DC3545;
      color: white;
    }

    .btn-danger:hover {
      background-color: #C82333;
    }

    .popup-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .popup-modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background: white;
      padding: 20px 30px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    .popup-content h3 {
      margin-bottom: 20px;
      color: #DC3545;
    }

    .popup-content ul {
      list-style: disc;
      padding-left: 20px;
      margin-bottom: 15px;
      text-align: left;
      font-size: 12px;
      color: #495057;
    }

    .popup-content button {
      cursor: pointer;
      font-weight: bold;
      margin-top: 20px;
      padding: 8px 15px;
      max-width: 100px;
      width: 100%;
    }

    #popup-ok-btn {
      background-color: #DC3545;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 5px;
      font-size: 12px;
    }

    /* ---- ANIMAÇÃO PÁGINA PRINCIPAL ----*/
    #page-main {
      opacity: 0;
      animation: pageEnter 1s ease-out forwards;
    }

    #page-main .card {
      transform: translateY(50px);
      opacity: 0;
      animation: cardSlideUp 0.8s ease-out 0.3s forwards;
    }

    #page-main .card-header {
      position: relative;
      overflow: hidden;
    }

    #page-main .card-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite 1.5s;
    }

    #page-main .card-body p {
      opacity: 0;
      transform: translateX(-20px);
      animation: textSlideIn 0.6s ease-out forwards;
    }

    #page-main .card-body p:nth-child(1) {
      animation-delay: 0.8s;
    }

    #page-main .card-body p:nth-child(2) {
      animation-delay: 1s;
    }

    #page-main .card-body p:nth-child(3) {
      animation-delay: 1.2s;
    }

    #page-main .card-body ul {
      opacity: 0;
      transform: translateX(-20px);
      animation: textSlideIn 0.6s ease-out forwards;
    }

    #page-main .card-body ul:nth-of-type(1) {
      animation-delay: 1.4s;
    }

    #page-main .card-body ul:nth-of-type(2) {
      animation-delay: 1.8s;
    }

    #page-main .card-body p:last-child {
      opacity: 0;
      transform: translateY(20px);
      animation: finalTextAppear 0.8s ease-out 2.2s forwards;
    }

    #page-main .card-body li {
      transition: all 0.3s ease;
      position: relative;
      padding-left: 15px;
    }

    #page-main .card-body li:hover {
      transform: translateX(5px);
      color: #DC3545;
    }

    #page-main .card-body li::before {
      content: '▶';
      position: absolute;
      left: 0;
      color: #DC3545;
      font-size: 0.8em;
      transition: all 0.3s ease;
      opacity: 0.7;
    }

    #page-main .card-body li:hover::before {
      opacity: 1;
      transform: scale(1.2);
    }

    @keyframes pageEnter {
      from {
        opacity: 0;
        transform: scale(0.98);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes cardSlideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes textSlideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes finalTextAppear {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    ul {
      list-style: none;
    }

    .digital-panel-container {
      display: flex;
      height: 550px;
      position: relative;
    }

    .panel-sidebar {
      width: 200px;
      background: rgba(52, 58, 64, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      padding: 0;
    }

    .panel-menu-button {
      width: 100%;
      height: 50px;
      background: transparent;
      color: #fff;
      border: none;
      text-align: left;
      padding: 0 20px;
      margin: 0;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-menu-button:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(3px);
    }

    .panel-menu-button.active {
      background: rgba(220, 53, 69, 0.8);
      border-left: 4px solid #fff;
      font-weight: 600;
    }

    .panel-menu-button::before {
      content: '▶';
      font-size: 10px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .panel-menu-button.active::before {
      opacity: 1;
    }

    .panel-content {
      flex: 1;
      background: rgba(248, 249, 250, 0.95);
      position: relative;
      overflow-y: auto;
    }

    .panel-card {
      display: none;
      background: rgba(235, 235, 235, 0.85);
      padding: 25px;
      height: 100%;
      animation: cardFadeIn 0.4s ease-out;
    }

    .panel-card.active {
      display: block;
    }

    .panel-card h3 {
      color: #343A40;
      font-size: 18px;
      margin-bottom: 20px;
      border-bottom: 2px solid #DC3545;
      padding-bottom: 10px;
    }

    .panel-card p {
      color: #495057;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .data-item {
      background: rgba(255, 255, 255, 0.8);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      height: 160px;
    }

    .data-item:hover {
      transform: translateY(-2px);
    }

    .data-value {
      font-size: 24px;
      font-weight: bold;
      color: #DC3545;
      display: block;
    }

    .data-label {
      font-size: 12px;
      color: #6C757D;
      margin-top: 5px;
    }

    .button-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 4px;
      margin-top: 10px;
      width: 100%;
      height: 60px;
    }

    .panel-btn {
      padding: 6px 8px;
      border: 1px solid #bdc3c7;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: bold;
      font-size: 11px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      min-width: 0;
    }

    .panel-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      filter: brightness(1.1);
    }

    .vehicle-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .vehicle-btn {
      padding: 15px 15px;
      border: 1.5px solid #bdc3c7;
      border-radius: 8px;
      background: #bdc3c7;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      height: 80px !important;
      max-height: 80px !important;
      min-height: 80px !important;
      display: flex !important;
      flex-direction: column !important;
      justify-content: center !important;
      align-items: center !important;
    }

    .vehicle-icon {
      font-size: 24px;
      display: block;
      margin-bottom: 8px;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
    }

    .vehicle-code {
      font-size: 14px;
      font-weight: bold;
      color: #2c3e50;
      transition: all 0.3s ease;
      position: relative;
      z-index: 2;
    }
    
    .vehicle-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
      z-index: 1;
    }

    .vehicle-btn:hover::before {
      left: 100%;
    }

    .vehicle-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      filter: brightness(1.1);
    }

    .vehicle-btn:active {
      animation: buttonBounce 0.3s ease;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.3);
    }

    .vehicle-btn.inop {
      border-color: #7f8c8d !important;
      color: #2c3e50 !important;
      opacity: 0.6;      
      position: relative;
      animation: inopFade 2s infinite;
    }

    .vehicle-btn.inop::before {
      content: "⚠️ INOP";
      position: absolute;
      top: 0px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      background: #e74c3c;
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: bold;
      z-index: 10;
      opacity: 0.5;
    }    

    .vehicle-btn.inop .vehicle-code {
      color: #7f8c8d !important;
      text-decoration: line-through;
    }

    @keyframes inopFade {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.5
      }
    }

    /* STATUS EM SERVIÇO */
    .vehicle-btn.em-servico {
      border: 2px solid #f1c40f;
      animation: borderBlink 1.5s infinite, gentleShake 3s infinite;
    }
    
     .vehicle-btn.em-servico::before {
      content: "🚨 Em Serviço";
      position: absolute;
      top: 0px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      background: rgba(241, 196, 15, 0.8);
      color: #2c3e50;
      padding: 2px 4px;
      border-radius: 2px;
      font-weight: bold;
      z-index: 10;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    @keyframes gentleShake {

      0%,
      100% {
        transform: translateX(0)
      }

      25% {
        transform: translateX(-1px)
      }

      75% {
        transform: translateX(1px)
      }
    }

    @keyframes borderBlink {

      0%,
      100% {
        border-color: #f1c40f
      }

      50% {
        border-color: #e67e22
      }
    }

    .loading {
      text-align: center;
      color: #7f8c8d;
      font-style: italic;
      margin: 20px 0;
      padding: 20px;
      background: #f0f0f0;
      border-radius: 8px;
    }

    .vehicle-btn.vcot,
    .vehicle-btn.vcoc,
    .vehicle-btn.vttp,
    .vehicle-btn.vfci,
    .vehicle-btn.veci,
    .vehicle-btn.vuci,
    .vehicle-btn.vrci,
    .vehicle-btn.vsat,
    .vehicle-btn.vsae,
    .vehicle-btn.vttu,
    .vehicle-btn.vttf,
    .vehicle-btn.vale,
    .vehicle-btn.vttr,
    .vehicle-btn.veta,
    .vehicle-btn.vope {
      border-color: #e74c3c;
    }

    .vehicle-btn.abci,
    .vehicle-btn.absc,
    .vehicle-btn.abtd,
    .vehicle-btn.abtm,
    .vehicle-btn.vdtd {
      border-color: #3498db;
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <img src="https://i.imgur.com/4Ho5HRV.png" alt="CB Faro Cruz Lusa" class="header-logo">
      </div>
      <div class="header-title-container">
        <h1 class="header-title">CORPO DE BOMBEIROS DE FARO - CRUZ LUSA</h1>
        <p class="header-subtitle">WSMS Auto Creator</p>
        <p class="header-authorization">Acesso Autorizado: <span id="authName"></span></p>
      </div>
      <div class="header-badge-360">Grupo CB360</div>
    </header>
    <div class="header-authorization">Acesso Autorizado: <span id="authName"></span></div>
    <!---- MÓDULO SIDEBAR ---->
    <aside class="sidebar">
      <button class="sidebar-menu-button active" data-page="page-main">🏠 Menu Principal</button>
      <button class="sidebar-menu-button" data-page="page-active_occurrences">🔥 Ocorrências em Curso</button>
      <button class="sidebar-menu-button" data-page="page_insert_occurrence">✏️ Inserir/Alterar Ocorrência</button>
      <button class="sidebar-menu-button" data-page="page_close_occurrence">🔐 Encerrar Ocorrência</button>
      <button class="sidebar-menu-button" data-page="page-solicitation">📋 Solicitação Disponibilidades</button>
      <button class="sidebar-menu-button" data-page="page-indisp">⚠️ Indisponibilidade Veículos</button>
      <button class="sidebar-menu-button" data-page="page-municipality-grid">🗂️ Info. Grelha Município</button>
      <button class="sidebar-menu-button" data-page="page-utilities">📱 Utilitários</button>
      <button class="sidebar-menu-button" data-page="page-data">💾 Data Center</button>
    </aside>
    <!---- MÓDULO POPUPS ---->
    <div id="popup-modal" class="popup-modal">
      <div class="popup-content">
        <h3>Campos em falta</h3>
        <ul id="missing-fields-list"></ul>
        <button id="popup-ok-btn">OK</button>
      </div>
    </div>
    <div id="popup-warning-modal" class="popup-modal">
      <div class="popup-content">
        <h3>AVISO</h3>
        <p></p>
        <button id="popup-warning-ok-btn" class="btn btn-danger">OK</button>
      </div>
    </div>
    <div id="popup-success-modal" class="popup-modal">
      <div class="popup-content">
        <h3>SUCESSO</h3>
        <p>Mensagem criada com sucesso! Abra o WhatsApp e prima CTRL+V</p>
        <button id="popup-success-ok-btn" class="btn btn-success">OK</button>
      </div>
    </div>
     <div id="popup-success-modal" class="popup-modal">
      <div class="popup-content">
        <h3>SUCESSO</h3>
        <p>Mensagem criada com sucesso! Abra o WhatsApp e prima CTRL+V</p>
        <button id="popup-success-ok-btn" class="btn btn-success">OK</button>
      </div>
    </div>
    
    
    <!---- MÓDULO COUNTEÚDO PRINCIPAL ---->
    <main class="main-content">
      <div id="page-main" class="page active">
        <div class="card last-card">
          <div class="card-header">BEM-VINDO AO SISTEMA CB360 ONLINE</div>
          <div class="card-body">
            <p style="margin-bottom: 15px;">Sistema automatizado para gestão operaional diária do Corpo de Bombeiros de Faro - Cruz Lusa.</p>
            <p style="margin-bottom: 15px;"><strong>Funcionalidades disponíveis:</strong></p>
            <p style="margin-bottom: 0px;"><strong>WSMS Auto Creator:</strong></p>
            <ul style="padding-left: 20px; margin-bottom: 15px;">
              <li>Ocorrências em Curso</li>
              <li>Inserir/Alterar Ocorrências</li>
              <li>Encerrar Ocorrências</li>
              <li>Solicitação de Disponibilidades</li>
              <li>Indisponibilidade de Veículos</li>
              <li>Info. Grelha do Município</li>
            </ul>
            <p style="margin-bottom: 0px;"><strong>Painel de Utilitários:</strong></p>
            <ul style="padding-left: 20px; margin-bottom: 15px;">
              <li>Visualização de estados dos EPEs e PPIs</li>
              <li>Visualização dos estados operacionais dos veículos</li>
            </ul>
            <p style="margin-bottom: 0px; margin-top: 15px;"><strong>Brevemente:</strong></p>
            <ul style="padding-left: 20px; margin-bottom: 15px;">
              <li><em>SALOC 360</em></li>
              <li><em>DECIR 360</em></li>
              <li><em>FOMIO 360</em></li>
            </ul>
            <p style="margin-top: 50px;"><em>Selecione uma opção no menu lateral para começar.</em></p>
          </div>
        </div>
      </div>
      <!---- MÓDULO OCORRÊNCIAS EM CURSO ---->
      <div id="page-active_occurrences" class="page">
        <h2 class="section-title">Ocorrências em Curso</h2>
        <div class="card">
          <div class="card-header">LISTA DE OCORRÊNCIAS ATIVAS</div>
          <div class="card-body">
            <div style="overflow-x: auto;">
              <table id="active-occurrences-table" style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <thead>
                  <tr style="background-color: #F8F9FA; border-bottom: 2px solid #DEE2E6;">
                    <th style="width: 150px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Data/Hora Alerta</th>
                    <th style="width: 250px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Descrição</th>
                    <th style="width: 350px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Local</th>
                    <th style="width: 300px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Localidade</th>
                    <th style="width: 75px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Veículos</th>
                    <th style="width: 125px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Estado</th>
                    <th style="width: 100px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Ações</th>
                  </tr>
                </thead>
                <tbody id="active-occurrences-tbody">
                </tbody>
              </table>
            </div>
            <div style="margin-top: 15px; text-align: right;">
              <button class="btn btn-success" onclick="loadActiveOccurrences()" style="font-size: 10px;">
                ATUALIZAR LISTA
              </button>
            </div>
          </div>
        </div>
        <!---- Popup Especial POSIT ---->
        <div id="popup-posit-modal" class="popup-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; ">
          <div class="popup-content" style="background-color: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 400px; width: 90%; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.3); ">
            <h3 style="margin-bottom: 15px;">POSIT</h3>
            <div style="display: flex; justify-content: center; align-items: center; width: 100%; margin: 5px 0;">
              <label for="posit-description" style="width: 90px; text-align: left;">Descrição:</label>
              <input type="text" id="posit-description" style="flex: 1; padding: 5px; border-radius: 6px; border: 1px solid #ccc; text-align: center;" readonly />
            </div>
            <div style="display: flex; justify-content: center; align-items: center; width: 100%; margin: 5px 0;">
              <label for="posit-local" style="width: 90px; text-align: left;">Local:</label>
              <input type="text" id="posit-local" style="flex: 1; padding: 5px; border-radius: 6px; border: 1px solid #ccc; text-align: center;" readonly />
            </div>
            <input type="hidden" id="posit-localidade-hidden" value="" />
            <div style="display: flex; justify-content: center; align-items: center; width: 100%; margin: 5px 0;">
              <label for="posit-status" style="width: 90px; text-align: left;">Estado:</label>
              <select id="posit-status" style="flex: 1; padding: 5px; border-radius: 6px; border: 1px solid #ccc;">
                <option value="Em Curso">Em Curso</option>
                <option value="Em Resolução">Em Resolução</option>
                <option value="Em Conclusão">Em Conclusão</option>
                <option value="Encerrada">Encerrada</option>
              </select>
            </div>
            <div style="display: flex; justify-content: left; align-items: center; width: 100%; margin: 5px 0;">
              <label for="posit-time" style="width: 90px; text-align: left;">Hora POSIT:</label>
              <input type="text" id="posit-time" style="width: 60px; padding: 5px; border-radius: 6px; border: 1px solid #ccc; text-align: center;" />
            </div>
            <div style="margin-top: 10px; text-align: left;">
              <label for="posit-text" style="display:block; margin-bottom: 5px;">POSIT:</label>
              <textarea id="posit-text" rows="5" style="width: 100%; padding: 5px; border-radius: 6px; border: 1px solid #ccc; resize: vertical;"></textarea>
            </div>
            <div style="margin-top: 5px; text-align: left;"> <input type="checkbox" id="desmobilizacao" />
              <label for="desmobilizacao" style="margin-left: 5px;">Desmobilização de meios</label>
            </div>
            <button id="posit-send-btn" class="btn btn-danger" style="width: 50%; margin-top: 10px;">Enviar POSIT</button>
          </div>
        </div>
      </div>
      <!---- MÓDULO NOVA OCORRÊNCIA ---->
      <div id="page_insert_occurrence" class="page">
        <h2 class="section-title">Dados para Nova Ocorrência</h2>
        <div class="card">
          <div class="card-header">DADOS GLOBAIS</div>
          <div class="card-body">
            <div class="form-row">
              <div class="form-group" style="width: 200px;">
                <label>Tipo Alerta:</label>
                <select id="alert_type">
                </select>
              </div>
              <div class="form-group" style="width: 200px;">
                <label>Fonte Alerta:</label>
                <select id="alert_source">
                </select>
              </div>
              <div class="form-group" id="ems_group" style="width: 100px;">
                <label>Nr. CODU:</label>
                <input type="text" id="ems_nr" placeholder="Ex. 123456789">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="width: 120px;">
                <label>Data Alerta:</label>
                <input type="date" id="alert_date" value="">
              </div>
              <div class="form-group" style="width: 80px;">
                <label>Hora Alerta:</label>
                <input type="time" id="alert_time" value="">
              </div>
              <div class="form-group" style="width: 100px;">
                <label>Class. Ocorrência:</label>
                <input type="text" id="class_occorr_input" placeholder="Ex. 3103" style="width: 100%; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 4)">
              </div>
              <div class="form-group" style="width: 100px;">
                <label>Nr. Ocorrência:</label>
                <input type="text" id="nr_occurrence_input" placeholder="Ex. 123456789" style="width: 100%; text-align: center;" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11)">
              </div>
              <div class="form-group" style="width: 300px; display: none;">
                <label>Descr. Ocorrência:</label>
                <input type="text" id="occorr_descr_input" placeholder="Inc. Mato">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="width: 350px;">
                <label>Morada Ocorrência:</label>
                <input type="text" id="occorr_local_input" placeholder="Ex. Rua Serpa Pinto, 00">
              </div>
              <div class="form-group" style="width: 200px;">
                <label>Localidade:</label>
                <input type="text" id="occorr_localitie_input" placeholder="Ex. Faro">
              </div>
              <div class="form-group" style="width: 150px;">
                <label>Concelho:</label>
                <select id="council_select">
                  <option></option>
                </select>
              </div>
              <div class="form-group" style="width: 175px;">
                <label>Freguesia:</label>
                <select id="parish_select">
                </select>
              </div>
              <div class="form-group" style="width: 100px;">
                <label>Canal Manobra:</label>
                <select id="channel_maneuver">
                  <option></option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="width: 200px;">
                <label>Tipo PPI:</label>
                <select id="ppi_type">
                </select>
              </div>
              <div class="form-group" style="width: 140px;">
                <label>Nível Alerta:</label>
                <select id="alert_level">
                  <option></option>
                </select>
              </div>
              <div class="form-group" style="width: 140px;">
                <label>Grelha Alarme:</label>
                <select id="alarm_grid">
                  <option></option>
                </select>
              </div>
              <div class="form-group" style="width: 80px;">
                <label>Km:</label>
                <input type="text" id="km">
              </div>
              <div class="form-group" style="width: 200px;">
                <label>Sentido:</label>
                <select id="on_going">
                </select>
              </div>
              <div class="form-group" style="width: 200px;">
                <label>Tipo Incidente:</label>
                <select id="incident_type">
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="width: 300px;">
                <label>Nome Contactante:</label>
                <input type="text" id="contact_name" placeholder="Ex. João Sousa">
              </div>
              <div class="form-group" style="width: 120px;">
                <label>Nr. Contactante:</label>
                <input type="text" id="contact_nr" placeholder="Ex. 910 000 000" style="width: 100%; text-align: center;" maxlength="9" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 9)">
              </div>
            </div>
          </div>
        </div>
        <div class="card last-card">
          <div class="card-header">VEÍCULOS AFETOS À OCORRÊNCIA</div>
          <div class="card-body">
            <div class="grid-2fr">
              <div class="vehicle-card">
                <div class="field-card-title">1º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time" value="time">
                  </div>
                </div>
              </div>
              <div class="vehicle-card">
                <div class="field-card-title">2º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time" value="time">
                  </div>
                </div>
              </div>
              <div class="vehicle-card">
                <div class="field-card-title">3º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time" value="time">
                  </div>
                </div>
              </div>
              <div class="vehicle-card">
                <div class="field-card-title">4º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time">
                  </div>
                </div>
              </div>
              <div class="vehicle-card">
                <div class="field-card-title">5º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time">
                  </div>
                </div>
              </div>
              <div class="vehicle-card">
                <div class="field-card-title">6º VEÍCULO</div>
                <div class="vehicle-fields">
                  <div class="vehicle-field" style="width: 120px;">
                    <label>Data Saída:</label>
                    <input type="date" value="">
                  </div>
                  <div class="vehicle-field" style="width: 150px;">
                    <label>Veículo:</label>
                    <select>
                      <option></option>
                    </select>
                  </div>
                  <div class="vehicle-field" style="width: 75px;">
                    <label>BBs:</label>
                    <input type="text" placeholder="00" style="width: 100%; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2)">
                  </div>
                  <div class="vehicle-field" style="width: 100px;">
                    <label>Hora Saída:</label>
                    <input type="time">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="warning-text">
            Caso o Tipo de Mensagem seja para enviar igualmente para o GRUPO OCORRÊNCIAS. Preencha todos os campos necessários, e prima em primeiro lugar botão, "WSMS BOMBEIROS", Obrigado.
          </div>
          <textarea id="wsms_output" rows="4" cols="50" readonly style="display: none;"></textarea>
          <div class="action-buttons">
            <button class="btn btn-success" onclick="generateWSMSMessage()">BOMBEIROS</button>
            <button class="btn btn-danger" onclick="generateNewCREPCMessage()">COMUNICAR CREPC</button>
          </div>
        </div>
      </div>
      <!---- MÓDULO ENCERRAR OCORRÊNCIA ---->
      <div id="page_close_occurrence" class="page">
        <h2 class="section-title">Dados para Encerramento da Ocorrência</h2>
        <div class="card">
          <div class="card-header">DADOS GLOBAIS</div>
          <div class="card-body">
            <div class="form-row" style="display: flex;">
              <div class="form-group" style="width: 200px;">
                <label>Nr. Ocorrência:</label>
                <input type="text" id="close_nr_occurrence" placeholder="Ex. 123456789" style="width: 100%; text-align: center;" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11)">
              </div>
            </div>
          </div>
          <div class="grid-3fr" style="margin: -20px 15px 15px 15px;">
            <div class="vehicle-card" style="min-height: 190px;  margin: 5px;">
              <div class="field-card-title">1º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
            <div class="vehicle-card" style="min-height: 190px; margin: 5px;">
              <div class="field-card-title">2º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
            <div class="vehicle-card" style="min-height: 190px; margin: 5px;">
              <div class="field-card-title">3º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
            <div class="vehicle-card" style="min-height: 190px; margin: 5px;">
              <div class="field-card-title">4º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
            <div class="vehicle-card" style="min-height: 190px; margin: 5px;">
              <div class="field-card-title">5º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
            <div class="vehicle-card" style="min-height: 190px; margin: 5px;">
              <div class="field-card-title">6º VEÍCULO</div>
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Sd. TO:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Sd. TO:</label>
                <input type="time" style="width: 75px;">
              </div>
              <div class="global-field-horizontal">
                <label>Dt. Ch. Und.:</label>
                <input type="date" style="width: 100px;">
                <label>Hr. Ch. Und.:</label>
                <input type="time" style="width: 75px;">
                <label>Kms.:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="4" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
              </div>
              <div class="global-field-horizontal">
                <label>Tempo Bomba:</label>
                <label>Hr:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                <label>Mins:</label>
                <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,2)">
              </div>
            </div>
          </div>
        </div>
        <div class="card last-card">
          <div class="card-header">DADOS ADICIONAIS</div>
          <div class="card-body">
            <div class="victims-card" style="min-height: 100px; margin: 5px 0 5px 0;">
              <div class="field-card-title">
                <label style="font-size: 12px;">VÍTIMAS</label>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal">
                  <label>Género:</label>
                  <select id="victim_1_gender" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Idade:</label>
                  <input type="text" id="victim_1_age_unit" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)"> <select id="victim_1_age" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Nacion:</label>
                  <input type="text" id="victim_1_nation" style="width: 175px;">
                </div>
                <div class="global-field-horizontal">
                  <label>Tipo:</label>
                  <select id="victim_1_type" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Estado:</label>
                  <select id="victim_1_status" style="width: 120px;">
                  </select>
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal">
                  <label>Género:</label>
                  <select id="victim_2_gender" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Idade:</label>
                  <input type="text" id="victim_2_age_unit" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                  <select id="victim_2_age" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Nacion:</label>
                  <input type="text" id="victim_2_nation" style="width: 175px;">
                </div>
                <div class="global-field-horizontal">
                  <label>Tipo:</label>
                  <select id="victim_2_type" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Estado:</label>
                  <select id="victim_2_status" style="width: 120px;">
                  </select>
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal">
                  <label>Género:</label>
                  <select id="victim_3_gender" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Idade:</label>
                  <input type="text" id="victim_3_age_unit" placeholder="0" style="width: 50px; text-align: center;" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,3)">
                  <select id="victim_3_age" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Nacion:</label>
                  <input type="text" id="victim_3_nation" style="width: 175px;">
                </div>
                <div class="global-field-horizontal">
                  <label>Tipo:</label> <select id="victim_3_type" style="width: 120px;">
                  </select>
                </div>
                <div class="global-field-horizontal">
                  <label>Estado:</label>
                  <select id="victim_3_status" style="width: 120px;">
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="grid-2fr" style="margin: -20px 15px 15px 15px;">
            <div class="extras-card" style="min-height: 100px;  max-width: 100%; margin: 5px 0 0 5px ;">
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px;">
                <div class="field-card-title">
                  <label style="font-size: 12px;">OUTROS MEIOS NO TO</label>
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>01.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>02.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>03.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>04.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>05.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>06.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>07.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>08.:</label>
                  <input type="text" style="width: 100%;">
                </div>
                <div class="global-field-horizontal">
                  <label>Veícs.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
                <div class="global-field-horizontal">
                  <label>Elems.:</label>
                  <input type="text" placeholder="0" style="width: 50px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
            </div>
            <div class="demage-card" style="min-height: 100px; max-width: 100%; margin: 5px 5px 0 0 ;">
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px;">
                <div class="field-card-title">
                  <label style="font-size: 12px;">DANOS CAUSADOS</label>
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>01.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>02.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>03.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>04.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>05.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>06.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>07.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>08.:</label>
                  <input type="text" style="width: 100%;">
                </div>
              </div>
            </div>
          </div>

          <div class="grid-2fr" style="margin: -10px 15px 15px 15px;">
            <div class="burned-card" style="min-height: 100px;  max-width: 100%; margin: 5px 0 15px 5px ;">
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px;">
                <div class="field-card-title">
                  <label style="font-size: 12px;">ÁREA ARDIDA</label>
                </div>
              </div>
              <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>01.:</label>
                  <input type="number" id="area_m2" placeholder="0" style="width: 15%; text-align: center;" oninput="updateHectares()">
                  <label>Mts.2</label>
                </div>
              </div>
              <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="flex:1;">
                  <label>02.:</label>
                  <input type="text" id="area_ha" placeholder="0" style="width: 15%; text-align: center;" readonly>
                  <label>Ha.</label>
                </div>
              </div>
            </div>
            <div class="demage-card" style="min-height: 100px; max-width: 100%; margin: 5px 5px 15px 0 ;">
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px;">
                <div class="field-card-title">
                  <label style="font-size: 12px;">OBSERVAÇÕES</label>
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="width: 100%;">
                  <textarea placeholder="Escreva suas observações..." rows="4" style="width: 100%; resize: vertical;"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="form-row" style="margin: 33px 0 0 0; display: flex; flex-wrap: wrap; justify-content: flex-end;">
            <div class="action-buttons">
              <button class="btn btn-danger" onclick="generateCloseCREPCMessage()">COMUNICAR CREPC</button>
            </div>
          </div>
        </div>
      </div>

      <!---- MÓDULO SOLICITAÇÃO DE DISPONIBILIDADES ---->
      <div id="page-solicitation" class="page">
        <h2 class="section-title">Solicitação de Disponibilidades para Serviços</h2>
        <div class="card">
          <div class="card-header">TIPO DE SOLICITAÇÃO</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Data do Serviço:</label>
                <input type="date" id="solicitation_date" style="width: 100px;">
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Tipo de Solicitação:</label>
                <select id="solicitation_type" style="width: 200px;">
                </select>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Motivo da Solicitação:</label>
                <select id="solicitation_motive" style="width: 200px;">
                </select>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Turno:</label>
                <select id="solicitation_shift" style="width: 75px;">
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">MEIOS SOLICITADOS</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Motoritas:</label>
                <div class="global-field-horizontal">
                  <input type="text" id="drivers" placeholder="0" style="width: 75px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
              <div class="global-field-horizontal">
                <label>Elementos:</label>
                <div class="global-field-horizontal">
                  <input type="text" id="elements" placeholder="0" style="width: 75px; text-align: center;" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,2)">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">DESTINO DO SERVIÇO</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Hora de Saída:</label>
                <div class="global-field-horizontal">
                  <input type="time" id="exit_hour" style="width: 75px;">
                </div>
              </div>
              <div class="global-field-horizontal">
                <label>ULS Destino:</label>
                <div class="global-field-horizontal">
                  <input type="text" id="uls_desteny" placeholder="Ex. IPO Lisboa" style="width: 250px; text-align: center;">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row" style="margin-top: 35px; margin-right: -20px; display: flex; justify-content: flex-end;">
          <div class="action-buttons">
            <button class="btn btn-success" onclick="generateAvailability()">SOLICITAR</button>
          </div>
        </div>
      </div>

      <!---- MÓDULO INDISPONIBILIDADE DE VEÍCULOS ---->
      <div id="page-indisp" class="page">
        <h2 class="section-title">Indisponibilidade Veículos</h2>
        <div class="card">
          <div class="card-header">NOVA INDISPONIBILIDADE DE VÉICULO</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="vehicle-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <select id="new_vehicle_unavailable" style="width: 150px;">
                </select>
              </div>
              <div class="global-field-horizontal" style="width: 300px;">
                <label>Motivo da Indisponibilidade:</label>
                <select id="new_reason_unavailability" style="width: 150px;">
                </select>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: -3px;">
              <div class="global-field-horizontal">
                <label>Data da Indisponibilidade:</label>
                <div class="extras-field-horizontal">
                  <input type="date" id="new_unavailability_date" style="width: 100px;">
                </div>
              </div>
              <div class="global-field-horizontal">
                <label>Hora da Indisponibilidade:</label>
                <div class="global-field-horizontal">
                  <input type="time" id="new_unavailability_hour" style="width: 75px;">
                </div>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal" style="width: 300px;">
                <label>Local da Indisponibilidade:</label>
                <select id="new_unavailability_local" style="width: 150px;">
                </select>
              </div>
            </div>
          </div>
          <div class="form-row" style="margin-top: 20px; margin-bottom: 0px; display: flex; justify-content: flex-end;">
            <div class="action-buttons">
              <button class="btn btn-danger" onclick="generateNewUnvailability()">ENVIAR INDISPONIBILIDADE</button>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">VEÍCULOS INDISPONÍVEIS</div>
          <div class="card-body">
            <table id="active-unavailability-table" style="width: 100%; border-collapse: collapse; font-size: 11px;">
              <thead>
                <tr style="background-color: #F8F9FA; border-bottom: 2px solid #DEE2E6;">
                  <th style="width: 150px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Data/Hora</th>
                  <th style="width: 200px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Veículo</th>
                  <th style="width: 400px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Motivo</th>
                  <th style="width: 200px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Estado</th>
                  <th style="width: 200px; padding: 8px; text-align: center; border: 1px solid #DEE2E6;">Parar</th>
                </tr>
              </thead>
              <tbody id="active-unavailability-tbody">
              </tbody>
            </table>
          </div>
          <div class="form-row" style="margin-top: 20px; margin-bottom: 0px; display: flex; justify-content: flex-end;">
            <div class="action-buttons">
              <button class="btn btn-success" onclick="loadActiveUnavailability()">ATUALIZAR LISTA</button>
            </div>
          </div>
        </div>
        <div id="availability-card" class="card last-card">
          <div class="card-header">FIM DE INDISPONIBILIDADE DE VÉICULO DE VÉICULO</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal" style="width: 150px;">
                <label>Veículo:</label>
                <div class="global-field-horizontal">
                  <input type="text" id="end_vehicle_unavailable" style="width: 100px; text-align: center;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal" style="width: 300px;">
                  <label>Motivo da Indisponibilidade:</label>
                  <div class="extras-field-horizontal">
                    <input type="text" id="end_reason_unavailability" style="width: 150px; text-align: center;">
                  </div>
                </div>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label>Data da Disponibilidade:</label>
                <div class="global-field-horizontal">
                  <input type="date" id="end_unavailability_date" style="width: 100px;">
                </div>
              </div>
              <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
                <div class="global-field-horizontal">
                  <label>Hora da Disponibilidade:</label>
                  <div class="global-field-horizontal">
                    <input type="time" id="end_unavailability_hour" style="width: 75px;">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-row" style="margin-top: 20px; margin-bottom: 15px; display: flex; justify-content: flex-end;">
            <div class="action-buttons">
              <button class="btn btn-success" onclick="generateEndUnavailability()">ENVIAR DISPONIBILIDADE</button>
            </div>
          </div>
        </div>
      </div>

      <!---- MÓDULO INFORMAÇÃO DE ESTADO GRELHA DO MUNICÍPIO ---->
      <div id="page-municipality-grid" class="page">
        <h2 class="section-title">Info. Grelha Município</h2>
        <div class="card" style="margin: 0 0 25px 0;">
          <div class="card-header">ESTADO OPERACIONAL DA GRELHA DO MUNICÍPIO</div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label style="font-size: 12px;">Estado Operacional:</label>
                <select id="state_municipality_grid" style="width: 200px;" onchange="toggleMunicipalityGridOutput()">
                </select>
              </div>
            </div>
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 0px;">
              <div class="global-field-horizontal">
                <label style="font-size: 12px;">Motivo do Estado:</label>
                <input type="text" id="municipality_grid_output" placeholder="Indique um motivo para o estado da grelha." style="width: 700px;">
              </div>
            </div>
            <div class="form-row" style="margin: 30px -25px -25px 0;display: flex; justify-content: flex-end;">
              <div class="action-buttons">
                <button class="btn btn-success" onclick="generateMunicipalityGridMessage()">ENVIAR ESTADO</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="page-utilities" class="page">
        <h2 class="section-title">Utiliários</h2>
        <div class="card card last-card">
          <div class="card-header">CONSOLA DE UTILITÁRIOS</div>
          <div class="digital-panel-container">
            <div class="panel-sidebar">
              <button class="panel-menu-button active" onclick="showPanelCard('epe')">Estado EPE/PPI</button>
              <button class="panel-menu-button" onclick="showPanelCard('system')">Sitop. Veículos</button>
              <button class="panel-menu-button" onclick="showPanelCard('monitoring')">Monitorização</button>
              <button class="panel-menu-button" onclick="showPanelCard('logs')">Logs do Sistema</button>
              <button class="panel-menu-button" onclick="showPanelCard('settings')">Configurações</button>
              <button class="panel-menu-button" onclick="showPanelCard('analytics')">Análises</button>
            </div>

            <!-- Área de Conteúdo -->
            <div class="panel-content">
              <!-- Card: Dashboard -->
              <div id="panel-epe" class="panel-card active">
                <h3>ESTADOS DE PRONTIDÃO ESPECIAL / PLANOS PRÉVIOS DE INTERVENÇÃO</h3>
                <p>Visão geral dos Estados de Prontidão Especiais e Planos Prévios de Intervenção.</p>

                <div class="data-grid">

                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">EPE SIOPS DECIR</span>

                    <div class="button-container" id="epe-decir">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL I</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL II</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL III</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL IV</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>

                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">EPE SIOPS DIOPS</span>
                    <div class="button-container" id="epe-diops">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL I</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL II</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL III</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL IV</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>

                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">EPE SIOPS NRBQ</span>
                    <div class="button-container" id="epe-nrbq">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL I</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL II</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL III</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">NÍVEL IV</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>
                </div>

                <div class="data-grid">
                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">PPI AEROPORTO</span>
                    <div class="button-container" id="ppi-aero">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">AMARELO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">VERMELHO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>

                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">PPI A22</span>
                    <div class="button-container" id="ppi-a22">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">1º ALARME</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">2º ALARME</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">ALARME ESPECIAL</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>

                  <div class="data-item">
                    <span class="data-value" style="font-size: 15px;">PPI LINHA FÉRREA</span>
                    <div class="button-container" id="ppi-linfer">
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">MONITORIZAÇÃO</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">1º ALARME</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">2º ALARME</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;">ALARME ESPECIAL</button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                      <button class="panel-btn" style="background-color: lightgrey; color: black;"></button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Card: Sistema -->
              <div id="panel-system" class="panel-card">
                <h3>SITUAÇÃO OPERACIONAL DE VEÍCULOS</h3>
                <p>Visão geral do estado operacional dos veículos.</p>
                <div id="vehicleStatus" class="loading">A carregar veículos...</div>
                <div class="vehicle-grid" id="vehicleGrid"></div>
              </div>

              <!-- Card: Monitorização -->
              <div id="panel-monitoring" class="panel-card">
                <h3>Monitorização em Tempo Real</h3>
                <p>Acompanhamento das operações críticas do sistema.</p>                
              </div>

              <!-- Card: Logs -->
              <div id="panel-logs" class="panel-card">
                <h3>Logs do Sistema</h3>
                <p>Registo detalhado das operações do sistema.</p>                      
              </div>

              <!-- Card: Configurações -->
              <div id="panel-settings" class="panel-card">
                <h3>Configurações do Sistema</h3>
                <p>Definições e parâmetros de funcionamento.</p>
               
              </div>
              
              <!-- Card: Análises -->
              <div id="panel-analytics" class="panel-card">
                <h3>Análises e Relatórios</h3>
                <p>Estatísticas e métricas de performance do sistema.</p>
                
              </div>
            </div>
          </div>
        </div>
      </div>

      <!---- MÓDULO GESTÃO DE DADOS ---->
      <div id="page-data" class="page">
        <h2 class="section-title">Data Center</h2>
        <div class="card">
          <div class="card-header">CENTRO DE DADOS</div>
          <div class="card-body">
            <p>Centro de dados do sistema em desenvolvimento.</p>
          </div>
        </div>
      </div>
    </main>
    <footer class="status-bar">
      <div class="system-info">
        WSMS Auto Creator v3.147.24 | Powered by: Fábio Martins | Sistemas de Informação
      </div>
    </footer>
  </div>
  <script src="cfgsbauth.js"></script>
  <script src="messages.js"></script>
  <script>
    const SUPABASE_URL = 'https://rjkbodfqsvckvnhjwmhg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqa2JvZGZxc3Zja3ZuaGp3bWhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNjM3NjQsImV4cCI6MjA2MzczOTc2NH0.jX5OPZkz1JSSwrahCoFzqGYw8tYkgE8isbn12uP43-0';

    function getSupabaseHeaders() {
      return {
        'apikey': SUPABASE_ANON_KEY,
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
        'Content-Type': 'application/json'
      };
    }
    const AUTH = 'Fábio Martins (Bombeiro de 2ª)';
    document.getElementById('authName').textContent = AUTH;
    /* ==============================
        GRUPO UTILITÁRIOS
     ============================== */
    /* ---- TRATAMENTO SCROLL BAR ----*/
    function showPageAndResetScroll(pageId, {
      smooth = false
    } = {}) {
      document.querySelectorAll('.page').forEach(p => {
        p.classList.remove('active');
        p.style.display = 'none';
      });
      const page = document.getElementById(pageId);
      if (!page) return;
      page.style.display = 'block';
      page.classList.add('active');
      requestAnimationFrame(() => {
        const main = document.querySelector('.main-content');
        if (main) {
          if (smooth) main.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
          else main.scrollTop = 0;
        }
        if (page.scrollTop !== undefined) {
          if (smooth) page.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
          else page.scrollTop = 0;
        }
        if (smooth) window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
        else window.scrollTo(0, 0);
        clearFormFields();
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.sidebar-menu-button[data-page]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const pageId = btn.getAttribute('data-page');
          if (!pageId) return;
          showPageAndResetScroll(pageId, {
            smooth: false
          });
          document.querySelectorAll('.sidebar-menu-button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
    });
    /* ---- NAVEGAÇÃO DA SIDEBAR ----*/
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".sidebar-menu-button");
      const pages = document.querySelectorAll(".page");

      function hideAllPages() {
        pages.forEach(p => p.classList.remove("active"));
      }

      function removeActiveFromButtons() {
        buttons.forEach(btn => btn.classList.remove("active"));
      }
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          hideAllPages();
          removeActiveFromButtons();
          btn.classList.add("active");
          const page = document.getElementById(btn.getAttribute("data-page"));
          if (page) page.classList.add("active");
        });
      });
    });
    /* ---- OBTENÇÃO E FORMATAÇÃO DE DATAS ----*/
    function padNumber(num) {
      return String(num).padStart(2, '0');
    }

    function getCurrentDateStr() {
      const d = new Date();
      return `${d.getFullYear()}-${padNumber(d.getMonth()+1)}-${padNumber(d.getDate())}`;
    }

    function formatGDH(dateStr, timeStr) {
      if (!dateStr || !timeStr) return '';
      const date = new Date(dateStr + 'T' + timeStr);
      const day = padNumber(date.getDate());
      const hours = padNumber(date.getHours());
      const minutes = padNumber(date.getMinutes());
      const monthNames = ["JAN", "FEV", "MAR", "ABR", "MAI", "JUN", "JUL", "AGO", "SET", "OUT", "NOV", "DEZ"];
      const month = monthNames[date.getMonth()];
      const year = String(date.getFullYear()).slice(-2);
      return `${day} *${hours}${minutes}* ${month}${year}`;
    }
    /* ---- CARREGAMENTO DE DADOS PARA CAMPOS ---- */
    /* --- Carregamento de Veículos ---*/
    async function fetchVehiclesFromSupabase() {
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/vehicle_status?select=vehicle`, {
          headers: getSupabaseHeaders()
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const vehicles = await response.json();
        return vehicles.map(vehicle => vehicle.vehicle);
      } catch (error) {
        console.error('Erro ao carregar veículos do Supabase:', error);
        return fallbackVehicles;
      }
    }
    async function populateVehicleSelects() {
      const vehicleSelects = document.querySelectorAll('.vehicle-field select, .vehicle-field-horizontal select');
      vehicleSelects.forEach(select => {
        select.innerHTML = '<option></option>';
      });
      let vehicles = await fetchVehiclesFromSupabase();
      vehicles.sort((a, b) => a.localeCompare(b, 'pt', {
        sensitivity: 'base'
      }));
      vehicleSelects.forEach(select => {
        select.innerHTML = '<option value=""></option>';
        vehicles.forEach(vehicle => {
          const option = document.createElement('option');
          option.value = vehicle;
          option.textContent = vehicle;
          select.appendChild(option);
        });
      });
    }
    /* --- Tratamento Tipo de Ocorrência --- */
    async function fetchClassOccorrById(classId) {
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/class_occorr?select=occorr_descr&class_occorr=eq.${encodeURIComponent(classId)}`, {
          headers: getSupabaseHeaders()
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        return data.length > 0 ? data[0].occorr_descr : '';
      } catch (error) {
        console.error("Erro ao buscar descrição da classe:", error);
        return '';
      }
    }
    const classOccorrInput = document.getElementById('class_occorr_input');
    if (classOccorrInput) {
      classOccorrInput.addEventListener('input', async (e) => {
        const classId = e.target.value.trim();
        const descrInput = document.getElementById('occorr_descr_input');
        if (!classId) {
          descrInput.value = '';
          return;
        }
        const descr = await fetchClassOccorrById(classId);
        descrInput.value = descr;
      });
    }
    /* --- Carregamento de Concelhos --- */
    async function fetchCouncilsFromSupabase() {
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/councils_select?select=id,council`, {
          headers: getSupabaseHeaders()
        });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const councils = await resp.json();
        return councils.map(c => ({
          id: c.id,
          name: c.council
        }));
      } catch (e) {
        console.error("Erro ao buscar concelhos:", e);
        return fallbackCouncils;
      }
    }
    async function populateCouncilSelect() {
      const sel = document.getElementById('council_select');
      if (!sel) return;
      sel.innerHTML = '<option></option>';
      const councils = (await fetchCouncilsFromSupabase()).sort((a, b) =>
        a.name.localeCompare(b.name, 'pt', {
          sensitivity: 'base'
        })
      );
      sel.innerHTML = '<option></option>';
      councils.forEach(c => {
        const o = document.createElement('option');
        o.value = c.id;
        o.textContent = c.name;
        sel.appendChild(o);
      });
      if (sel.value) {
        populateParishes(sel.value);
      }
    }
    /* --- Carregamento de Freguesias ---*/
    async function fetchParishesByCouncil(councilId) {
      if (!councilId) return [];
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/parishes_select?select=parish&council_id=eq.${councilId}`, {
          headers: getSupabaseHeaders()
        });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const parishes = await resp.json();
        return parishes.map(p => p.parish);
      } catch (e) {
        console.error("Erro ao buscar freguesias:", e);
        return fallbackParishes[councilId] || [];
      }
    }
    async function populateParishes(councilId) {
      const sel = document.getElementById('parish_select');
      if (!sel) return;
      sel.innerHTML = '';
      const parishes = (await fetchParishesByCouncil(councilId)).sort((a, b) =>
        a.localeCompare(b, 'pt', {
          sensitivity: 'base'
        })
      );
      sel.innerHTML = '';
      parishes.forEach(p => {
        const o = document.createElement('option');
        o.value = p;
        o.textContent = p;
        sel.appendChild(o);
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      const councilSelect = document.getElementById('council_select');
      if (councilSelect) {
        populateCouncilSelect();
        councilSelect.addEventListener('change', async (e) => {
          const councilId = e.target.value;
          const parishSelect = document.getElementById('parish_select');
          if (!councilId) {
            parishSelect.innerHTML = '<option value=""></option>';
            return;
          }
          await populateParishes(councilId);
        });
      }
    });
    /* --- Carregamento de Parâmetros Globais ---*/
    async function fetchGlobalOptions(category) {
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/static_options?select=value&category=eq.${category}`, {
          headers: getSupabaseHeaders()
        });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        return data.map(d => d.value).filter(v => v); // ignora nulos
      } catch (e) {
        console.error(`Erro ao buscar opções de ${category}:`, e);
        return [];
      }
    }
    async function populateGlobalSelects() {
      const globalFields = [{
          id: 'alert_type',
          category: 'alert_type'
        },
        {
          id: 'alert_source',
          category: 'alert_source'
        },
        {
          id: 'channel_maneuver',
          category: 'channel_maneuver'
        },
        {
          id: 'ppi_type',
          category: 'ppi_type'
        },
        {
          id: 'solicitation_type',
          category: 'solicitation_type'
        },
        {
          id: 'solicitation_motive',
          category: 'solicitation_motive'
        },
        {
          id: 'solicitation_shift',
          category: 'solicitation_shift'
        },
        {
          id: 'new_reason_unavailability',
          category: 'reason_unavailability'
        },
        {
          id: 'new_unavailability_local',
          category: 'local_unavailability'
        },
        {
          id: 'state_municipality_grid',
          category: 'municipality_grid'
        }
      ];
      const victimCategories = ['victim_gender', 'victim_age', 'victim_type', 'victim_status'];
      const victimsCount = 3;
      const victimFields = [];
      for (let i = 1; i <= victimsCount; i++) {
        for (let cat of victimCategories) {
          const fieldId = `victim_${i}_${cat.split('_')[1]}`;
          victimFields.push({
            id: fieldId,
            category: cat
          });
        }
      }
      const allFields = [...globalFields, ...victimFields];
      for (let f of allFields) {
        const select = document.getElementById(f.id);
        if (!select) {
          console.warn(`Select com id "${f.id}" não encontrado.`);
          continue;
        }
        select.innerHTML = '<option></option>';
        const options = await fetchGlobalOptions(f.category);
        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          select.appendChild(o);
        });
      }
    }
    document.addEventListener('DOMContentLoaded', populateGlobalSelects);
    /* ---- POPUPUS E AVISOS ----*/
    function showPopupMissingFields(fields) {
      const modal = document.getElementById('popup-modal');
      const list = document.getElementById('missing-fields-list');
      if (!modal || !list) return;
      list.innerHTML = '';
      fields.forEach(f => {
        const li = document.createElement('li');
        li.textContent = f;
        list.appendChild(li);
      });
      modal.classList.add('show');
      const okBtn = document.getElementById('popup-ok-btn');
      if (okBtn) okBtn.onclick = () => modal.classList.remove('show');
    }

    function showPopupSuccess(clearFields = false) {
      const modal = document.getElementById('popup-success-modal');
      if (!modal) return;
      modal.classList.add('show');
      const okBtn = document.getElementById('popup-success-ok-btn');
      if (okBtn) {
        okBtn.onclick = () => {
          modal.classList.remove('show');
          if (clearFields) clearFormFields();
        };
      }
    }

    function showPopupWarning(message) {
      const modal = document.getElementById('popup-warning-modal');
      if (!modal) return;
      const textElem = modal.querySelector('p');
      if (textElem) textElem.textContent = message;
      modal.classList.add('show');
      const okBtn = document.getElementById('popup-warning-ok-btn');
      if (okBtn) okBtn.onclick = () => modal.classList.remove('show');
    }
    /* ==============================
       GRUPO OCORRÊNCIAS EM CURSO
    ============================== */
    function parseDateTime(dateTimeStr) {
      if (!dateTimeStr) return null;
      const [datePart, timePart] = dateTimeStr.split(' ');
      if (!datePart || !timePart) return null;
      const [day, month, year] = datePart.split('/').map(Number);
      const [hours, minutes] = timePart.split(':').map(Number);
      return new Date(year, month - 1, day, hours, minutes);
    }
    /* ---- LEITURA, CARREGAMENTO E AVISO DE OCORRÊNCIAS ---- */
    let blinkInterval = null;

    function startBlinkingSidebarButton() {
      const btn = document.querySelector('.sidebar-menu-button[data-page="page-active_occurrences"]');
      if (!btn || blinkInterval) return;
      const originalColor = '#343A40';
      const activeColor = '#DC3545';
      let isOriginal = false;
      blinkInterval = setInterval(() => {
        btn.style.backgroundColor = isOriginal ? originalColor : activeColor;
        isOriginal = !isOriginal;
      }, 900);
    }

    function stopBlinkingSidebarButton() {
      const btn = document.querySelector('.sidebar-menu-button[data-page="page-active_occurrences"]');
      if (!btn) return;
      clearInterval(blinkInterval);
      blinkInterval = null;
      btn.style.backgroundColor = '';
    }
    async function tableHasData() {
      const tbody = document.getElementById('active-occurrences-tbody');
      if (!tbody) return false;
      return Array.from(tbody.rows).some(row => !row.querySelector('td[colspan]'));
    }
    async function updateSidebarButtonBlinking() {
      if (await tableHasData()) {
        startBlinkingSidebarButton();
      } else {
        stopBlinkingSidebarButton();
      }
    }
    loadActiveOccurrences().then(() => updateSidebarButtonBlinking());
    setInterval(updateSidebarButtonBlinking, 1000);
    async function loadActiveOccurrences() {
      const tbody = document.getElementById('active-occurrences-tbody');
      if (!tbody) return;
      tbody.innerHTML = '';
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control?select=*,vehicles&status=in.(Em Curso,Em Resolução,Em Conclusão)`, {
          headers: getSupabaseHeaders()
        });
        if (!resp.ok) throw new Error(`HTTP error! status: ${resp.status}`);
        const occurrences = await resp.json();
        if (occurrences.length === 0) {
          tbody.innerHTML = `
        <tr>
          <td colspan="8" style="padding: 20px; text-align: center; color: #6C757D;">
            Não existem ocorrências ativas neste momento.
          </td>
        </tr>`;
          return;
        }
        occurrences.forEach(occ => {
          const startDate = parseDateTime(occ.start_date);
          let formattedDate = occ.start_date;
          if (startDate) {
            formattedDate = `${String(startDate.getDate()).padStart(2,'0')}/${String(startDate.getMonth()+1).padStart(2,'0')}/${startDate.getFullYear()} ${String(startDate.getHours()).padStart(2,'0')}:${String(startDate.getMinutes()).padStart(2,'0')}`;
          }
          let vehiclesCount = 0;
          if (Array.isArray(occ.vehicles)) vehiclesCount = occ.vehicles.length;
          else if (typeof occ.vehicles === 'string') vehiclesCount = occ.vehicles.split(',').filter(v => v.trim() !== '').length;
          const tr = document.createElement('tr');
          tr.innerHTML = `
        <td style="text-align: center; border: 1px solid #DEE2E6;">${formattedDate}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">${occ.occorrence}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">${occ.local}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">${occ.localitie}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">${vehiclesCount}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">${occ.status}</td>
        <td style="text-align: center; border: 1px solid #DEE2E6;">
          <button class="btn btn-danger posit-btn" style="font-size: 10px;">POSIT</button>
        </td>        
      `;
          tbody.appendChild(tr);
          tr.querySelector('.posit-btn').addEventListener('click', () => openPositPopup(occ));
        });
      } catch (error) {
        console.error("Erro ao carregar ocorrências ativas:", error);
        tbody.innerHTML = `
      <tr>
        <td colspan="8" style="padding: 20px; text-align: center; color: red;">
          Erro ao carregar ocorrências
        </td>
      </tr>`;
      }
    }
    /* ---- POPUP ESPECIAL DE  POSIT ---- */
    let currentPositId = null;

    function openPositPopup(occurrence) {
      currentPositId = occurrence.id;
      document.getElementById('posit-description').value = occurrence.occorrence || '';
      document.getElementById('posit-local').value = occurrence.local || '';
      document.getElementById('posit-localidade-hidden').value = occurrence.localitie || '';
      document.getElementById('posit-status').value = occurrence.status || '';
      document.getElementById('posit-text').value = '';
      document.getElementById('posit-time').value = '';
      document.getElementById('desmobilizacao').checked = false;
      document.getElementById('popup-posit-modal').style.display = 'flex';
    }
    const positTimeInput = document.getElementById('posit-time');
    positTimeInput.addEventListener('input', (e) => {
      let val = e.target.value.replace(/\D/g, '');
      if (val.length > 4) val = val.slice(0, 4);
      let hours = val.slice(0, 2);
      let minutes = val.slice(2, 4);
      if ((hours.length === 2 && Number(hours) > 23) || (minutes.length === 2 && Number(minutes) > 59)) {
        e.target.value = '';
        return;
      }
      e.target.value = minutes ? `${hours}:${minutes}` : hours;
    });

    function closePositPopup() {
      document.getElementById('popup-posit-modal').style.display = 'none';
      loadActiveOccurrences();
    }
    document.getElementById('posit-send-btn').onclick = async function() {
      const status = document.getElementById('posit-status').value;
      if (!currentPositId) {
        showPopupWarning("Não selecionou nenhuma ocorrência.");
        return;
      }
      const occorrence = document.getElementById('posit-description').value;
      const local = document.getElementById('posit-local').value;
      const localidade = document.getElementById('posit-localidade-hidden').value;
      const horaPosit = document.getElementById('posit-time').value;
      const positText = document.getElementById('posit-text').value;
      const desmobilizacao = document.getElementById('desmobilizacao').checked;
      let mensagem = `*🚨🚨INFORMAÇÃO🚨🚨*\n\n`;
      mensagem += `*Ocorrência: ${occorrence}, _${local}, ${localidade}._*\n`;
      mensagem += `*\\\\POSIT: ${horaPosit},* _${positText}_`;
      if (desmobilizacao) mensagem += ` _*Desmobilização dos Meios Integrantes.*_`;
      try {
        if (status === "Encerrada") {
          const resp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control?id=eq.${currentPositId}`, {
            method: "DELETE",
            headers: getSupabaseHeaders()
          });
          if (!resp.ok) throw new Error(`Erro ao apagar ocorrência: ${resp.status}`);
        } else if (status !== document.getElementById('posit-status').defaultValue) {
          const resp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control?id=eq.${currentPositId}`, {
            method: "PATCH",
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
              'Content-Type': 'application/json',
              'Prefer': 'return=representation'
            },
            body: JSON.stringify({
              status
            })
          });
          if (!resp.ok) throw new Error(`Erro ao atualizar ocorrência: ${resp.status}`);
        }
        navigator.clipboard.writeText(mensagem).then(() => {
          if (typeof showPopupSuccess === 'function') {}
          showPopupSuccess("Mensagem POSIT copiada!");
          setTimeout(() => closePositPopup(), 500);
        }).catch(err => {
          console.error("Erro ao copiar POSIT:", err);
        });
      } catch (err) {
        console.error("Erro POSIT:", err);
        showPopupWarning("Erro ao enviar POSIT!");
      }
    };
    document.addEventListener('DOMContentLoaded', () => {
      const btnActive = document.querySelector('button[data-page="page-active_occurrences"]');
      if (btnActive) {
        btnActive.addEventListener('click', () => {
          loadActiveOccurrences();
        });
      }
    });
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('popup-posit-modal').style.display = 'none';
      loadActiveOccurrences();
    });
    /* ==============================
       GRUPO INSERIR OCORRÊNCIAS
    ============================== */
    /* ---- TOOGLE DE CAMPO DINÂMICOS ----*/
    /* --- Toogle Tipo de Alerta ---*/
    function toggleAlertTypeFields() {
      const alertType = document.getElementById('alert_type')?.value;
      const ppiType = document.getElementById('ppi_type')?.value;
      const ppiTypeField = document.getElementById('ppi_type');
      const alertLevel = document.getElementById('alert_level');
      const alarmGrid = document.getElementById('alarm_grid');
      const kmField = document.getElementById('km');
      const kmLabel = document.querySelector('label[for="km"]');
      const onGoing = document.getElementById('on_going');
      const incidentType = document.getElementById('incident_type');
      const blockFields = [ppiTypeField, alertLevel, alarmGrid, kmField, onGoing, incidentType];
      if (alertType !== 'Plano Prévio de Intervenção') {
        blockFields.forEach(field => {
          if (!field) return;
          field.value = '';
          field.disabled = true;
          if (field.tagName === 'SELECT' && field !== ppiTypeField) {
            field.innerHTML = '<option value=""></option>';
          }
        });
        if (ppiTypeField) {
          ppiTypeField.disabled = true;
          ppiTypeField.value = '';
        }
        if (kmLabel) kmLabel.textContent = "Km:";
        return;
      }
      blockFields.forEach(field => {
        if (field) field.disabled = false;
      });
      if (ppiType === 'PPI Aeroporto Gago Coutinho') {
        ['km', 'on_going', 'incident_type'].forEach(id => {
          const f = document.getElementById(id);
          if (f) f.disabled = true;
        });
      }
      if (kmLabel || kmField) {
        let label = kmLabel || kmField?.previousElementSibling;
        if (label) {
          if (ppiType === 'PPI Via do Infante - A22') {
            label.textContent = "Km:";
          } else if (ppiType === 'PPI Linha Férrea do Algarve') {
            label.textContent = "Pkm:";
          } else {
            label.textContent = "Km:";
          }
        }
      }
      if (alertLevel) {
        alertLevel.innerHTML = '<option value=""></option>';
        let options = [];
        if (ppiType === 'PPI Aeroporto Gago Coutinho') {
          options = ['AMARELO', 'VERMELHO'];
        } else if (ppiType) {
          options = ['1º ALARME', '2º ALARME', 'ALARME ESPECIAL'];
        }
        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          alertLevel.appendChild(o);
        });
      }
      if (alarmGrid) {
        alarmGrid.innerHTML = '<option value=""></option>';
        let gridOptions = [];
        if (ppiType === 'PPI Aeroporto Gago Coutinho') {
          gridOptions = ['A1', 'A2', 'A3', 'A4', 'B1'];
        } else if (ppiType === 'PPI Via do Infante - A22') {
          const letters = 'ABCDEFGHIJKLMNOPQRST';
          letters.split('').forEach(l => {
            gridOptions.push(`1${l}`);
            gridOptions.push(`2${l}`);
          });
        } else if (ppiType === 'PPI Linha Férrea do Algarve') {
          const letters = 'ABCDEFGHIJKLMNOP';
          gridOptions = letters.split('');
        }
        gridOptions.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          alarmGrid.appendChild(o);
        });
      }
      if (incidentType) {
        incidentType.innerHTML = '<option value=""></option>';
        let incidents = [];
        if (ppiType === 'PPI Via do Infante - A22') {
          incidents = ['Acidente', 'Substâncias Perigosas', 'Incêndio em Transportes'];
        } else if (ppiType === 'PPI Linha Férrea do Algarve') {
          incidents = [
            'Acidente - Abalroamento, Choque e Descarrilamento',
            'Substâncias Perigosas - Produtos Químicos/Produtos Biológicos',
            'Incêndio em Transportes'
          ];
        }
        incidents.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          incidentType.appendChild(o);
        });
      }
      if (onGoing) {
        onGoing.innerHTML = '<option value=""></option>';
        let directions = [];
        if (ppiType === 'PPI Via do Infante - A22') {
          directions = [
            'Faro --- Vila Real de Santo António',
            'Faro --- Portimão'
          ];
        } else if (ppiType === 'PPI Linha Férrea do Algarve') {
          directions = [
            'Tunes --- Lagos',
            'Tunes --- Vila Real de Santo António'
          ];
        }
        directions.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          onGoing.appendChild(o);
        });
      }
    }
    /* --- Toogle INEM-CODU ---*/
    function toggleEMSNrField() {
      const alertSource = document.getElementById('alert_source')?.value;
      const emsGroup = document.getElementById('ems_group');
      if (!emsGroup) return;
      emsGroup.style.display = (alertSource === 'CODU' || alertSource === 'INEM') ? 'flex' : 'none';
    }
    /* --- Toogle Contactos ---*/
    function toggleContactFields() {
      const alertSource = document.getElementById('alert_source')?.value;
      const contactName = document.getElementById('contact_name');
      const contactNr = document.getElementById('contact_nr');
      if (!contactName || !contactNr) return;
      if (alertSource === 'Popular') {
        contactName.disabled = false;
        contactNr.disabled = false;
      } else {
        contactName.disabled = true;
        contactNr.disabled = true;
        contactName.value = '';
        contactNr.value = '';
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      toggleAlertTypeFields();
      document.getElementById('alert_type')?.addEventListener('change', toggleAlertTypeFields);
      document.getElementById('ppi_type')?.addEventListener('change', toggleAlertTypeFields);
      const alertSourceSelect = document.getElementById('alert_source');
      if (alertSourceSelect) {
        toggleEMSNrField();
        toggleContactFields();
        alertSourceSelect.addEventListener('change', () => {
          toggleEMSNrField();
          toggleContactFields();
        });
      }
    });
    /* ---- LIMPEZA E VALIDALÇÃO DE CAMPOS ---- */
    function getAlertTime() {
      const t = document.getElementById('alert_time')?.value;
      return t || '';
    }

    function clearFormFields() {
      const today = getCurrentDateStr();
      document.querySelectorAll('input[type="text"], input[type="time"]').forEach(i => i.value = '');
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
      document.querySelectorAll('input[type="date"]').forEach(i => i.value = today);
      document.querySelectorAll('textarea').forEach(t => t.value = '');
      setTimeout(() => {
        const parishSelect = document.getElementById('parish_select');
        if (parishSelect) {
          parishSelect.innerHTML = '';
        }
      }, 10);
    }

    function validateRequiredFields() {
      const missingFields = [];
      const alertType = document.getElementById('alert_type')?.value;
      const alertSource = document.getElementById('alert_source')?.value;
      if (!alertType) missingFields.push("Tipo de Alerta");
      if (!alertSource) missingFields.push("Fonte do Alerta");
      const emsGroup = document.getElementById('ems_group');
      const emsNr = document.getElementById('ems_nr');
      if (emsGroup && emsGroup.style.display !== 'none' && !emsNr.value.trim()) missingFields.push("Nr. CODU");
      if (!document.getElementById('alert_time')?.value) missingFields.push("Hora do Alerta");
      if (!document.getElementById('class_occorr_input')?.value) missingFields.push("Classificação da Ocorrência");
      if (!document.getElementById('occorr_local_input')?.value) missingFields.push("Local da Ocorrência");
      if (!document.getElementById('occorr_localitie_input')?.value) missingFields.push("Localidade da Ocorrência");
      if (alertSource === 'Popular') {
        if (!document.getElementById('contact_name')?.value.trim()) missingFields.push("Nome do Contactante");
        if (!document.getElementById('contact_nr')?.value.trim()) missingFields.push("Contacto do Contactante");
      }
      const hasVehicle = Array.from(document.querySelectorAll('.vehicle-card select')).some(sel => sel.value.trim() !== '');
      if (!hasVehicle) missingFields.push("A ocorrência deve conter pelo menos 1 Veículo");
      if (missingFields.length > 0) {
        showPopupMissingFields(missingFields);
        return false;
      }
      return true;
    }
    /* ---- CRIAÇÃO DE MENSAGEM DE NOVA OCORRÊNCIA CREPC ----*/
    function generateNewCREPCMessage() {
      if (!validateRequiredFields()) return '';
      const alertSource = 'CREPC Algarve';
      const alertDate = document.getElementById('alert_date')?.value || '';
      const alertTime = document.getElementById('alert_time')?.value || '';
      const classOccorr = document.getElementById('class_occorr_input')?.value || '';
      const localOccorr = document.getElementById('occorr_local_input')?.value || '';
      const localitie = document.getElementById('occorr_localitie_input')?.value || '';
      const councilSelect = document.getElementById('council_select');
      const council = councilSelect ? councilSelect.options[councilSelect.selectedIndex]?.text || '' : '';
      const parishSelect = document.getElementById('parish_select');
      const parish = parishSelect ? parishSelect.options[parishSelect.selectedIndex]?.text || '' : '';
      const nrOccurrence = document.getElementById('nr_occurrence_input')?.value?.trim() || '';
      const gdhAlerta = formatGDH(alertDate, alertTime);
      const vehicles = [];
      document.querySelectorAll('.vehicle-card').forEach(card => {
        const vehicle = card.querySelector('select')?.value?.trim() || '';
        const bbs = card.querySelector('input[type="text"]')?.value?.trim() || '';
        const vDate = card.querySelector('input[type="date"]')?.value || '';
        const vTime = card.querySelector('input[type="time"]')?.value || '';
        const gdhVehicle = formatGDH(vDate, vTime);
        if (vehicle) {
          vehicles.push(`*GDH Sd Und:* ${vehicle} | ${gdhVehicle} | ${bbs ? bbs + ' BBs.' : ''}`);
        }
      });
      let message = '';
      if (nrOccurrence) {
        message =
          `*➕ Agregar à Ocorrência*\n\n` +
          `*FONTE ALERTA:* ${alertSource}\n` +
          `*N. OC:* ${nrOccurrence}\n` +
          `*GDH ALERTA:* ${gdhAlerta}\n` +
          `*CLASS OC:* ${classOccorr}\n` +
          `*LOCAL:* ${localOccorr} - ${localitie} - ${council} - ${parish}\n` +
          `${vehicles.join('\n')}`;
      } else {
        message =
          `*✅ Registo de Nova Ocorrência*\n\n` +
          `*FONTE ALERTA:* ${alertSource}\n` +
          `*GDH ALERTA:* ${gdhAlerta}\n` +
          `*CLASS OC:* ${classOccorr}\n` +
          `*LOCAL:* ${localOccorr} - ${localitie} - ${council} - ${parish}\n` +
          `${vehicles.join('\n')}\n\n` +
          `*Agradeço N. OC:*`;
      }
      const out = document.getElementById('wsms_output');
      if (out) out.value = message;
      if (navigator.clipboard?.writeText) navigator.clipboard.writeText(message).catch(() => {});
      showPopupSuccess(true);
      return message;
    }
    /* ---- CRIAÇÃO DE MENSAGEM DE NOVA OCORRÊNCIA GLOBAL ----*/
    let lastWSMSData = null;
    async function generateWSMSMessage() {
      if (!validateRequiredFields()) return '';
      const alertTime = getAlertTime();
      const alertType = document.getElementById('alert_type')?.value || '';
      const alertSource = document.getElementById('alert_source')?.value || '';
      const descrOccorr = document.getElementById('occorr_descr_input')?.value || '';
      const localitie = document.getElementById('occorr_localitie_input')?.value || '';
      const localOccorr = document.getElementById('occorr_local_input')?.value || '';
      const ppiType = document.getElementById('ppi_type')?.value || '';
      const alertLevel = document.getElementById('alert_level')?.value || '';
      const ppiGrid = document.getElementById('alarm_grid')?.value || '';
      const ppiKm = document.getElementById('km')?.value || '';
      const ppiDirection = document.getElementById('on_going')?.value || '';
      const ppiIncident = document.getElementById('incident_type')?.value || '';
      const channelManeuver = document.getElementById('channel_maneuver')?.value?.trim() || '';
      const vehicles = [];
      document.querySelectorAll('.vehicle-card').forEach(card => {
        const vehicle = card.querySelector('select')?.value?.trim() || '';
        const bbs = card.querySelector('input[type="text"]')?.value?.trim() || '';
        if (vehicle) vehicles.push(bbs ? `${vehicle}|${bbs} BBs.` : vehicle);
      });
      const currentData = {
        alertType,
        alertSource,
        descrOccorr,
        localitie,
        localOccorr,
        ppiType,
        alertLevel,
        ppiGrid,
        ppiKm,
        ppiDirection,
        ppiIncident,
        vehicles: vehicles.join(',')
      };
      if (lastWSMSData && JSON.stringify(lastWSMSData) === JSON.stringify(currentData)) {
        showPopupWarning("Já existe uma ocorrência com as mesmas características.");
        return document.getElementById('wsms_output')?.value || '';
      }
      lastWSMSData = currentData;
      let message = '';
      const vehicleText = vehicles.length ? `Saída de ${vehicles.join(', ')}` : '';
      const vehicleSufix = vehicleText ? `, ${vehicleText}` : '';
      if (alertType === 'Ocorrência') {
        message = `*🚨🚨INFORMAÇÃO🚨🚨*\n\n*\\\\${alertSource}, HI: ${alertTime}, Ativação para ${descrOccorr} em Faro\\${localitie}\\${localOccorr}${vehicleSufix}* `;
      } else if (alertType === 'Plano Prévio de Intervenção') {
        if (ppiType === 'PPI Aeroporto Gago Coutinho') {
          if (alertLevel === 'Amarelo') {
            message = `*🚨🚨INFORMAÇÃO🚨🚨*\n\n*\\\\${alertSource}, HI: ${alertTime}, Ativação do ${ppiType} de nível ${alertLevel}, para a Grelha ${ppiGrid}, PREVENÇÃO LOCAL.*`;
          } else if (alertLevel === 'Vermelho') {
            const zoneLRT = "37.020046,-7.973326";
            const zoneZCR = "37.019382,-7.977624";
            const vehiclesLRT = "VCOT, ABSC - Devem Posicionar-se na LRT";
            const vehiclesZCR = "VCI, VTT - Devem Posicionar-se na ZCR";
            message = `*🚨🚨INFORMAÇÃO🚨🚨*\n\n*\\\\${alertSource}, HI: ${alertTime}, Ativação do ${ppiType} de nível VERMELHO, para a Grelha ${ppiGrid}, MOBILIZAÇÃO TOTAL DO CB.*\n\n*Veículos: ${vehiclesLRT}*\n*Veículos: ${vehiclesZCR}*\n\n*LOCALIZAÇÃO LRT:* (https://www.google.com/maps?q=${zoneLRT})\n*LOCALIZAÇÃO ZCR:* (https://www.google.com/maps?q=${zoneZCR})`;
          }
        } else {
          message = `*🚨🚨INFORMAÇÃO🚨🚨*\n\n*\\\\${alertSource}, HI: ${alertTime}, Ativação do ${alertLevel} para o ${ppiType}, para a Grelha ${ppiGrid}, ao km: ${ppiKm}, no sentido ${ppiDirection} para ${ppiIncident}*`;
        }
      }
      if (channelManeuver) {
        message += `*Canal Manobra:${channelManeuver}*`;
      }
      const out = document.getElementById('wsms_output');
      if (out) out.value = message;
      if (navigator.clipboard?.writeText) navigator.clipboard.writeText(message).catch(() => {});
      showPopupSuccess(false);
      await saveOccurrenceToSupabase(currentData, vehicles.length);
      loadActiveOccurrences();
      return message;
    }
    /* ---- GRAVAÇÃO DE OCORRÊNCIA EM DB ----*/
    async function saveOccurrenceToSupabase(data, vehiclesCount) {
      try {
        const alertDate = document.getElementById('alert_date')?.value || '';
        const alertTime = document.getElementById('alert_time')?.value || '';
        if (!alertDate || !alertTime) {
          console.error("Data ou hora do alerta em falta");
          return null;
        }
        const startDateTime = new Date(`${alertDate}T${alertTime}`);
        const formattedDate =
          `${String(startDateTime.getDate()).padStart(2,'0')}/${String(startDateTime.getMonth()+1).padStart(2,'0')}/${startDateTime.getFullYear()} ` +
          `${String(startDateTime.getHours()).padStart(2,'0')}:${String(startDateTime.getMinutes()).padStart(2,'0')}`;
        const query = `occorrence=eq.${encodeURIComponent(data.descrOccorr)}&local=eq.${encodeURIComponent(data.localOccorr)}&localitie=eq.${encodeURIComponent(data.localitie)}&start_date=eq.${encodeURIComponent(formattedDate)}`;
        const checkResp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control?${query}`, {
          headers: getSupabaseHeaders()
        });
        const existing = await checkResp.json();
        if (existing.length > 0) {
          const existingOccurrence = existing[0];
          let existingVehiclesCount = 0;
          if (Array.isArray(existingOccurrence.vehicles)) {
            existingVehiclesCount = existingOccurrence.vehicles.length;
          } else if (typeof existingOccurrence.vehicles === 'string') {
            existingVehiclesCount = existingOccurrence.vehicles.split(',').filter(v => v.trim() !== '').length;
          }
          if (existingVehiclesCount === vehiclesCount) {
            showPopupWarning("Já existe uma ocorrência com estas características.");
            return null;
          } else {
            const updateResp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control?id=eq.${existingOccurrence.id}`, {
              method: 'PATCH',
              headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
              },
              body: JSON.stringify({
                vehicles: vehiclesCount
              })
            });
            return await updateResp.json();
          }
        }
        const insertResp = await fetch(`${SUPABASE_URL}/rest/v1/occurrences_control`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify({
            start_date: formattedDate,
            occorrence: data.descrOccorr,
            local: data.localOccorr,
            localitie: data.localitie,
            vehicles: vehiclesCount,
            status: "Em Curso"
          })
        });
        return await insertResp.json();
      } catch (e) {
        console.error("Erro ao gravar ocorrência:", e);
        showPopupWarning("❌ Erro inesperado.");
        return null;
      }
    }
    document.addEventListener('DOMContentLoaded', async () => {
      document.querySelectorAll('input[type="date"]').forEach(i => i.value = getCurrentDateStr());
      document.querySelectorAll('input[type="time"]').forEach(i => i.value = '');
      await populateCouncilSelect();
      await populateVehicleSelects();
      toggleEMSNrField();
      toggleContactFields();
      document.getElementById('alert_source')?.addEventListener('change', () => {
        toggleEMSNrField();
        toggleContactFields();
      });
    });
    /* ==============================
       GRUPO ENCERRAMENTO OCORRÊNCIAS
    ============================== */
    /* ---- COVERSÃO DE MT²-Ha ---- */
    function updateHectares() {
      const m2Input = document.getElementById('area_m2');
      const haInput = document.getElementById('area_ha');
      const m2 = parseFloat(m2Input.value) || 0;
      const ha = m2 / 10000;
      haInput.value = ha.toFixed(2);
    }
    /* ---- CRIAÇÃO DE MENSAGEM DE ENCERRAMENTO DE OCORRÊNCIA CREPC ----*/
    function generateCloseCREPCMessage() {
      const nrOccurrence = document.getElementById('close_nr_occurrence')?.value?.trim();
      if (!nrOccurrence) {
        showPopupWarning("Por favor, preencha o Nr. de Ocorrência para poder encerrar a ocorrência.");
        return;
      }
      const sections = [];
      sections.push(`*❌ Encerramento de Ocorrência*`);
      sections.push(`*N. OC:* ${nrOccurrence}`);
      const vehicleBlocks = [];
      document.querySelectorAll('.vehicle-card').forEach(card => {
        const vehicle = card.querySelector('select')?.value?.trim();
        if (!vehicle) return;
        const dates = card.querySelectorAll('input[type="date"]');
        const times = card.querySelectorAll('input[type="time"]');
        const texts = card.querySelectorAll('input[type="text"]');
        const chTODate = dates[0]?.value;
        const chTOTime = times[0]?.value;
        const sdTODate = dates[1]?.value;
        const sdTOTime = times[1]?.value;
        const chUndDate = dates[2]?.value;
        const chUndTime = times[2]?.value;
        const kms = texts[0]?.value?.trim() || '';
        const timePumpH = texts[1]?.value?.trim();
        const timePumpM = texts[2]?.value?.trim();
        const lines = [];
        lines.push(`*GDH Ch TO:* ${vehicle} | ${formatGDH(chTODate, chTOTime)}`);
        lines.push(`*GDH Sd TO:* ${vehicle} | ${formatGDH(sdTODate, sdTOTime)}`);
        lines.push(`*GDH Ch Und:* ${vehicle} | ${formatGDH(chUndDate, chUndTime)}${kms ? ' | ' + kms + ' Kms' : ''}`);
        if (timePumpH || timePumpM) {
          lines.push(`*TEMPO BOMBA:* ${timePumpH || '00'} Hrs. ${timePumpM || '00'} Mins.`);
        }
        vehicleBlocks.push(lines.join('\n'));
      });
      if (vehicleBlocks.length) {
        sections.push(vehicleBlocks.join('\n\n'));
      }
      const victimLines = [];
      for (let i = 1; i <= 3; i++) {
        const gender = document.getElementById(`victim_${i}_gender`)?.value?.trim();
        const age = document.getElementById(`victim_${i}_age`)?.value?.trim();
        const ageUnit = document.getElementById(`victim_${i}_age_unit`)?.value?.trim();
        const nation = document.getElementById(`victim_${i}_nation`)?.value?.trim();
        const type = document.getElementById(`victim_${i}_type`)?.value?.trim();
        const status = document.getElementById(`victim_${i}_status`)?.value?.trim();
        if (gender || age || nation || type || status) {
          const parts = [];
          if (gender) parts.push(gender);
          if (age) parts.push(`${age}${ageUnit ? ' ' + ageUnit : ''}`);
          if (nation) parts.push(`Nacion: ${nation}`);
          if (type) parts.push(type);
          if (status) parts.push(status);
          victimLines.push(parts.join(' | '));
        }
      }
      if (victimLines.length) {
        sections.push(`*VÍTIMAS:*\n${victimLines.join('\n')}`);
      }
      const extrasLines = [];
      document.querySelectorAll('.extras-card').forEach(card => {
        const label = card.querySelector('label')?.textContent?.trim();
        if (label?.toLowerCase().includes('outros meios')) {
          card.querySelectorAll('.form-row').forEach(row => {
            const inputs = row.querySelectorAll('input[type="text"]');
            const meio = inputs[0]?.value?.trim();
            const veics = inputs[1]?.value?.trim();
            const elems = inputs[2]?.value?.trim();
            if (meio || veics || elems) {
              const parts = [];
              if (meio) parts.push(meio);
              if (veics) parts.push(`Veícs.: ${veics}`);
              if (elems) parts.push(`Elems.: ${elems}`);
              extrasLines.push(parts.join(' | '));
            }
          });
        }
      });
      if (extrasLines.length) {
        sections.push(`*OUTROS MEIOS NO TO:*\n${extrasLines.join('\n')}`);
      }
      const damageLines = [];
      document.querySelectorAll('.demage-card').forEach(card => {
        const label = card.querySelector('label')?.textContent?.trim();
        if (label?.toLowerCase().includes('danos')) {
          card.querySelectorAll('input[type="text"]').forEach(input => {
            const dano = input?.value?.trim();
            if (dano) damageLines.push(dano);
          });
        }
      });
      if (damageLines.length) {
        sections.push(`*DANOS:*\n${damageLines.join('\n')}`);
      }
      const areaM2 = document.getElementById('area_m2')?.value?.trim();
      const areaHa = document.getElementById('area_ha')?.value?.trim();
      if (areaM2 || areaHa) {
        const parts = [];
        if (areaM2) parts.push(`${areaM2} m²`);
        if (areaHa) parts.push(`${areaHa} ha`);
        sections.push(`*ÁREA ARDIDA:*\n${parts.join(' | ')}`);
      }
      const observations = document.querySelector('.observ-card textarea')?.value?.trim();
      if (observations) {
        sections.push(`*OBSERVAÇÕES:*\n${observations}`);
      }
      const message = sections.join('\n\n');
      const out = document.getElementById('wsms_output');
      if (out) out.value = message;
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(message).catch(() => {});
      }
      showPopupSuccess(true);
      return message;
    }
    /* ==============================
       GRUPO SOLICITAÇÕES
    ============================== */
    /* ---- CRIAÇÃO DE MENSAGEM DE SOLICITAÇÃO DE ELEMENTOS ----*/
    function generateAvailability() {
      function formatDate(dateStr) {
        if (!dateStr) return '';
        const [year, month, day] = dateStr.split('-');
        return `${day}/${month}/${year}`;
      }
      const dateService = document.getElementById('solicitation_date')?.value?.trim();
      const typeRequest = document.getElementById('solicitation_type')?.value?.trim();
      const motiveRequest = document.getElementById('solicitation_motive')?.value?.trim();
      const shift = document.getElementById('solicitation_shift')?.value?.trim();
      const drivers = document.querySelector('#drivers')?.value?.trim();
      const elements = document.querySelector('#elements')?.value?.trim();
      const hourOut = document.querySelector('#exit_hour')?.value;
      const destination = document.querySelector('#uls_desteny')?.value?.trim() || '';
      if (!typeRequest && !motiveRequest && !drivers && !elements) {
        showPopupWarning('Por favor, preencha pelo menos um dos campos antes de efetuar a solicitação.');
        return;
      }
      let message = '*🚨🚨INFORMAÇÃO🚨🚨*\n\n';
      let partes = [];
      if (drivers || elements) {
        let meioText = 'Solicita-se ';
        if (drivers) meioText += `${drivers} Motorista(s)`;
        if (drivers && elements) meioText += ' e ';
        if (elements) meioText += `${elements} Elemento(s)`;
        if (typeRequest === 'INEM') meioText += ' TAS';
        if (typeRequest === 'Reforço Piquete') meioText += ' Preferencialmente TAS';
        partes.push(meioText);
      }
      if (typeRequest) {
        let tipoText = `para efetuar serviço de ${typeRequest}`;
        if (typeRequest === 'Transporte de Doentes') {
          tipoText += ` para ${destination}`;
          if (dateService) tipoText += ` no dia ${formatDate(dateService)}`;
          if (hourOut) tipoText += `, com saída da unidade pelas ${hourOut}`;
          else tipoText += `, com saída da unidade pelas 10:10`;
        } else {
          if (dateService) tipoText += ` no dia ${formatDate(dateService)}`;
          if (shift) tipoText += ` no turno ${shift}`;
        }
        partes.push(tipoText);
      }
      if (typeRequest === 'Reforço Piquete' && motiveRequest === 'Grelha Município') {
        partes.push(`afim de assegurar a ${motiveRequest}`);
      }
      message += partes.join(' ') + '. ';
      let destinatario = 'SALOC';
      if (typeRequest === 'DECIR' || typeRequest === 'DIOPS') destinatario = 'Sr. Adjunto de Comando';
      message += `As disponibilidades deverão ser remetidas ao ${destinatario}, com a maior brevidade possível. Obrigado!`;
      const out = document.getElementById('wsms_output');
      if (out) out.value = message;
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(message).catch(() => {});
      }
      showPopupSuccess(true);
      document.getElementById('solicitation_motive').disabled = true;
      document.getElementById('solicitation_shift').disabled = true;
      document.getElementById('exit_hour').disabled = true;
      document.getElementById('uls_desteny').disabled = true;
      return message;
    }

    function toggleFields() {
      const typeSelect = document.getElementById('solicitation_type');
      const motiveSelect = document.getElementById('solicitation_motive');
      const shieftSelect = document.getElementById('solicitation_shift');
      const hourOutInput = document.getElementById('exit_hour');
      const destinationInput = document.getElementById('uls_desteny');
      if (typeSelect.value === 'Transporte de Doentes') {
        hourOutInput.disabled = false;
        destinationInput.disabled = false;
        motiveSelect.disabled = true;
        shieftSelect.disabled = true;
      } else if (typeSelect.value) {
        hourOutInput.disabled = true;
        destinationInput.disabled = true;
        motiveSelect.disabled = false;
        shieftSelect.disabled = false;
        hourOutInput.value = '';
        destinationInput.value = '';
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('solicitation_motive').disabled = true;
      document.getElementById('solicitation_shift').disabled = true;
      document.getElementById('exit_hour').disabled = true;
      document.getElementById('uls_desteny').disabled = true;
      toggleFields();
      document.getElementById('solicitation_type')
        .addEventListener('change', toggleFields);
    });
    /* ==============================
       GRUPO INDISPONIBILIDADES
    ============================== */
    /* ---- CRIAÇÃO DE MENSAGEM DE VEÍCULOS INDISPONÍVEIS ---- */
    let lastUnavailabilityData = null;
    async function generateNewUnvailability() {
      let vehicle = document.getElementById('new_vehicle_unavailable')?.value || '';
      const startDate = document.getElementById('new_unavailability_date')?.value || '';
      const startHour = document.getElementById('new_unavailability_hour')?.value || '';
      const motive = document.getElementById('new_reason_unavailability')?.value || '';
      const local = document.getElementById('new_unavailability_local')?.value || '';
      if (!vehicle || !startDate || !startHour || !motive || !local) {
        showPopupWarning("Preencha todos os campos obrigatórios!");
        return '';
      }
      if (vehicle === 'ABSC-02') {
        vehicle = 'INEM-Reserva';
      } else if (vehicle === 'ABSC-01' || vehicle === 'ABSC-03') {
        vehicle = 'INEM';
      }
      const gdh = formatGDH(startDate, startHour);
      const currentData = {
        vehicle,
        startDate,
        startHour,
        motive,
        local
      };
      try {
        const query = `vehicle=eq.${encodeURIComponent(vehicle)}&start_unavailability_date=eq.${encodeURIComponent(startDate)}&start_unavailability_hour=eq.${encodeURIComponent(startHour)}`;
        const checkResp = await fetch(`${SUPABASE_URL}/rest/v1/vehicle_unavailability?${query}`, {
          headers: getSupabaseHeaders()
        });
        const existing = await checkResp.json();
        console.log("🔍 Query usada:", query);
        console.log("📦 Resposta Supabase:", existing);
        if (existing.length > 0) {
          showPopupWarning("Já existe um registo de indisponibilidade para este veículo com as mesmas caractisticas.");
          return '';
        }
      } catch (e) {
        console.error("❌ Erro ao verificar Supabase:", e);
        showPopupWarning("Erro ao verificar indisponibilidades.");
        return '';
      }
      lastUnavailabilityData = currentData;
      let message = '';
      if (motive === "Pausa para Alimentação") {
        message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\n${motive}, ${local}, ${gdh}`;
      } else if (motive === "Falta de Macas" || motive === "Aguarda Triagem") {
        message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\nRetido(a) por: ${motive}, ${local}, ${gdh}`;
      } else {
        message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\nInoperacional por: ${motive}, ${local}, ${gdh}.`;
      }
      const out = document.getElementById('wsms_output');
      if (out) out.value = message;
      if (navigator.clipboard?.writeText) navigator.clipboard.writeText(message).catch(() => {});
      showPopupSuccess(true);
      await saveUnavailabilityToSupabase(currentData);
      loadActiveUnavailability();
      return message;
    }
    /* ---- GRAVAÇÃO DE VEÍCULOS INDISPONÍVEIS EM DB ---- */
    async function saveUnavailabilityToSupabase(data) {
      try {
        const insertResp = await fetch(`${SUPABASE_URL}/rest/v1/vehicle_unavailability`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify({
            vehicle: data.vehicle,
            start_unavailability_date: data.startDate,
            start_unavailability_hour: data.startHour,
            unavailability_motive: data.motive,
            status: "Em Aberto",
          })
        });
        const inserted = await insertResp.json();
        console.log("🚚 Indisponibilidade gravada:", inserted);
        return inserted;
      } catch (e) {
        console.error("❌ Erro inesperado:", e);
        showPopupWarning("Erro inesperado ao gravar indisponibilidade.");
        return null;
      }
    }
    async function loadActiveUnavailability() {
      const tbody = document.getElementById('active-unavailability-tbody');
      if (!tbody) return;
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/vehicle_unavailability?status=eq.Em%20Aberto`, {
          headers: getSupabaseHeaders()
        });
        const data = await resp.json();
        tbody.innerHTML = '';
        if (data.length === 0) {
          tbody.innerHTML = `
        <tr>
          <td colspan="8" style="padding: 30px; text-align: center; color: #6C757D;">
            Não existem veículos indisponíveis neste momento.
          </td>
        </tr>`;
          return;
        }

        function formatDateDisplay(dateTimeStr) {
          if (!dateTimeStr) return '';
          const [datePart, timePart] = dateTimeStr.split(' ');
          const [year, month, day] = datePart.split('-');
          return `${day}/${month}/${year} ${timePart}`;
        }
        data.forEach(item => {
          const tr = document.createElement('tr');
          const dateHour = formatDateDisplay(`${item.start_unavailability_date} ${item.start_unavailability_hour}`);
          tr.innerHTML = `
        <td style="text-align:center; border: 1px solid #DEE2E6;">${dateHour}</td>
        <td style="text-align:center; border: 1px solid #DEE2E6;">${item.vehicle}</td>
        <td style="text-align:center; border: 1px solid #DEE2E6;">${item.unavailability_motive}</td>
        <td style="text-align:center; border: 1px solid #DEE2E6;">${item.status}</td>
        <td style="text-align:center; border: 1px solid #DEE2E6;">
          <button class="btn btn-danger btn-sm finalize-btn">Finalizar Indisponibilidade</button>
        </td>
      `;
          const finalizeBtn = tr.querySelector('.finalize-btn');
          finalizeBtn.addEventListener('click', () => {
            document.getElementById('end_vehicle_unavailable').value = item.vehicle;
            document.getElementById('end_reason_unavailability').value = item.unavailability_motive;
            const endCard = document.getElementById('availability-card');
            if (endCard) {
              endCard.style.display = 'block';
            }
          });
          tbody.appendChild(tr);
        });
      } catch (e) {
        console.error("Erro ao carregar indisponibilidades:", e);
        showPopupWarning("❌ Erro ao carregar indisponibilidades em aberto.");
      }
    }
    /* ---- CRIAÇÃO DE MENSAGEM DE FIM DE INDISPONIBILIDADE DE VEÍCULOS E REMOÇÃO EM DB ---- */
    async function generateEndUnavailability() {
      const vehicle = document.getElementById('end_vehicle_unavailable')?.value || '';
      const motive = document.getElementById('end_reason_unavailability')?.value || '';
      const endDateField = document.getElementById('end_unavailability_date')?.value;
      const endHourField = document.getElementById('end_unavailability_hour')?.value;
      const endCard = document.querySelector('.card.last-card');
      if (!vehicle || !motive || !endDateField || !endHourField) {
        showPopupWarning("Preencha os campos obrigatórios!");
        return '';
      }
      try {
        const query = `vehicle=eq.${encodeURIComponent(vehicle)}&unavailability_motive=eq.${encodeURIComponent(motive)}&status=eq.Em%20Aberto`;
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/vehicle_unavailability?${query}`, {
          headers: getSupabaseHeaders()
        });
        const data = await resp.json();
        if (data.length === 0) {
          showPopupWarning("Não foi encontrada indisponibilidade em aberto para este veículo.");
          return '';
        }
        const record = data[0];
        const startDateTime = new Date(`${record.start_unavailability_date}T${record.start_unavailability_hour}`);
        const endDateTime = new Date(`${endDateField}T${endHourField}`);
        const diffMs = endDateTime - startDateTime;
        const hours = Math.floor(diffMs / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        const timeUnavailable = `${padNumber(hours)}h${padNumber(minutes)}m`;
        const gdhEnd = formatGDH(endDateField, endHourField);
        let displayName = vehicle;
        if (vehicle === "ABSC-02") {
          displayName = "INEM-Reserva";
        } else if (vehicle === "ABSC-01" || vehicle === "ABSC-03") {
          displayName = "INEM";
        }
        let message = '';
        if (motive === "Pausa para Alimentação") {
          message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\nFim de: ${motive}, ${gdhEnd}.\nTempo Indisponível: ${timeUnavailable}.`;
        } else if (motive === "Falta de Macas" || motive === "Aguarda Triagem") {
          message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\nFim de Retenção por: ${motive}, ${gdhEnd}.\nTempo Indisponível: ${timeUnavailable}.`;
        } else {
          message = `*🚨INFORMAÇÃO🚨*\n\n*${vehicle}:*\nFim de Inoperacionalidade por: ${motive}, ${gdhEnd}.\nTempo Indisponível: ${timeUnavailable}.`;
        }
        const out = document.getElementById('wsms_output');
        if (out) out.value = message;
        if (navigator.clipboard?.writeText) navigator.clipboard.writeText(message).catch(() => {});
        showPopupSuccess(true);
        await fetch(`${SUPABASE_URL}/rest/v1/vehicle_unavailability?id=eq.${record.id}`, {
          method: 'DELETE',
          headers: getSupabaseHeaders()
        });
        console.log("✅ Indisponibilidade finalizada e removida:", record);
        const endCard = document.getElementById('availability-card');
        if (endCard) {
          endCard.style.display = 'none';
        }
        loadActiveUnavailability();
        return message;
      } catch (e) {
        console.error("❌ Erro ao gerar fim de indisponibilidade:", e);
        showPopupWarning("Erro ao gerar mensagem de fim de indisponibilidade.");
        return '';
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      loadActiveUnavailability();
    });
    /* ==============================
       GRUPO GRELHA MUNICÍPIO      
    ============================== */
    /* ---- PREENCHIMENTO AUTOMÁTICO DE MENSAGEM E TOOGLE DE CAMPOS ---- */
    function autoFillMunicipalityGrid() {
      const state = document.getElementById('state_municipality_grid')?.value?.trim();
      const out = document.getElementById('municipality_grid_output');
      if (!out || !state) return;
      if (state === 'Sem Constrangimentos') {
        out.value = 'Selecionou Sem Constrangimentos, a mensagem foi gerada de forma automática.';
      } else {
        out.value = '';
      }
    }
    document.getElementById('state_municipality_grid').addEventListener('change', autoFillMunicipalityGrid);

    function toggleMunicipalityGridOutput() {
      const state = document.getElementById('state_municipality_grid')?.value?.trim();
      const motive = document.getElementById('municipality_grid_output');
      if (!motive) return;
      if (state === 'Sem Constrangimentos') {
        motive.value = "Selecionou Sem Constrangimentos, a mensagem foi gerada de forma automática.";
        motive.readOnly = true;
      } else {
        motive.value = "";
        motive.readOnly = false;
      }
    }
    /* ---- CRIAÇÃO DE MENSAGEM DE ESTADO DA GRELHA DO MUNICÍPIO ---- */
    function generateMunicipalityGridMessage() {
      const state = document.getElementById('state_municipality_grid')?.value?.trim();
      const motive = document.getElementById('municipality_grid_output');
      let message = '';
      if (state === 'Sem Constrangimentos') {
        message = `*🚨INFORMAÇÃO🚨*\n\n*✅ Grelha do Município 100% assegurada sem qualquer constrangimento.*\n\n_Planeamento será emitido oportunamente._`;
      } else if (state === 'Com Constrangimentos') {
        message = `*🚨INFORMAÇÃO🚨*\n\n*⚠️ Grelha do Município irá encontrar-se com constrangimentos.*\n\n*Motivo: ${motive.value}*\n\n_Planeamento será emitido oportunamente._`;
      } else if (state === 'Inoperacional') {
        message = `*🚨INFORMAÇÃO🚨*\n\n*❌ Grelha do Município irá ficar Inoperacional.*\n\n*Motivo: ${motive.value}*\n\n_Planeamento será emitido oportunamente._`;
      }
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(message).catch(() => {});
      }
      showPopupSuccess(false);
      return message;
    }  
  </script>

</body>

</html>
